{"version":3,"sources":["Components/ChartModel.js","Components/ChartOption.js","Components/ChartView.js","App.js","serviceWorker.js","index.js"],"names":["parseQuery","query","toString","replace","result","split","forEach","part","trim","parts","attr","decodeURIComponent","length","f","parseFloat","normalizeConfig","config","lines","l","_ids","ids","colors","_colors","names","_names","units","_units","i","push","id","offset","name","aggregate","color","thickness","strokeWidth","shadowsize","min","max","unit","aggregateType","aggregateSpan","relativeEnd","j","art","instance","yOffset","validTime","m","marks","lineId","upperValueOrId","v","lowerValueOrId","vl","c","fill","ol","t","os","s","text","d","textPosition","p","textOffset","py","textColor","fc","textSize","fs","width","height","timeFormat","useComma","zoom","export","grid_hideX","grid_hideY","hoverDetail","noLoader","noedit","animation","parseInt","afterComma","undefined","timeType","module","exports","constructor","socket","options","Object","assign","updateTimeout","this","serverSide","seriesData","ticks","liveInterval","navOptions","sessionId","updateInterval","presetSubscribed","defaultHistory","onUpdateFunc","onReadingFunc","onErrorFunc","objectPromises","debug","zoomData","lastHash","window","location","hash","onHashInstalled","onHashChangeBound","onHashChange","bind","addEventListener","onPresetUpdateBound","onPresetUpdate","getSystemConfig","then","systemConfig","common","analyseAndLoadConfig","preset","search","hQuery","data","JSON","parse","e","_config","clearInterval","startsWith","includes","getObject","obj","native","type","console","error","stringify","isFloatComma","lang","language","live","readData","unsubscribeObject","subscribeObject","stopLive","setInterval","presetUpdateTimeout","clearTimeout","setTimeout","newConfig","setNewRange","log","Date","toISOString","readOnZoomTimeout","destroy","removeEventListener","onUpdate","cb","onReading","onError","getConfig","setConfig","getStartStop","index","step","end","start","_now","option","range","monthRange","a","addTime","now","minusMonth","setMonth","getMonth","Math","floor","getTime","ignoreNull","count","from","ack","q","addID","startTime","endTime","start_time","map","Number","end_time","setHours","indexOf","minutes","setMinutes","getMinutes","setSeconds","setMilliseconds","hours","getHours","setDate","getDate","getDay","setFullYear","getFullYear","readOneChart","getHistoryEx","res","warn","values","_series","val","value","ts","unshift","exact","last","Promise","resolve","catch","err","_readObject","_readOneLine","chartType","en","_readData","readTicks","splice","readValue","getState","state","readMarkings","upperValue","lowerValue","time","plusOrMinus","isOffsetInMinutes","_ticks","THEMES","azul","infographic","vintage","dark","macarons","shine","roma","royal","red","green","light","gray","padding2","num","moment","themeType","calcTextWidth","Error","chart","yAxis","setThemeName","getHelperChartData","convertData","yAxisIndex","xMin","xMax","getSeries","theme","colorCount","oneLine","commonYAxis","cfg","xAxisIndex","showSymbol","points","hoverAnimation","smooth","itemStyle","symbolSize","symbol","lineStyle","shadowBlur","shadowOffsetY","shadowColor","dashes","areaStyle","opacity","getXAxis","splitLine","show","xaxe","grid_color","splitNumber","xticks","position","axisTick","alignWithLabel","x_ticks_color","axisLabel","formatter","xFormatter","x_labels_color","getYAxis","series","yMin","yMax","diff","isNaN","ceil","yaxe","yticks","yFormatter","y_labels_color","y_ticks_color","getMarkings","oneMark","lowerLimitFloat","upperLimitFloat","isLowerNumber","isUpperNumber","markArea","borderWidth","limitFloat","markLine","label","param","distance","textStyle","fontStyle","fontSize","line","withUnit","interpolated","toFixed","round","isXLabelHasBreak","withSeconds","withTime","_index","date","format","getSeconds","getInterpolatedValue","hoverNoNulls","k","y1","y2","renderTooltip","params","find","seriesIndex","filter","join","getLegend","xAxisHeight","legend","left","padLeft","right","padRight","top","bottom","backgroundColor","legBg","legColor","getTitle","title","titlePos","titleSize","titleColor","textVerticalAlign","textAlign","getOption","xAxis","noAnimation","grid","bg_custom","tooltip","trigger","axisPointer","ser","cY","minTick","maxTick","wMin","wMax","axis","canvasCalcTextWidth","fontFamily","context","document","createElement","getContext","font","metrics","measureText","ChartView","React","Component","props","super","updateProperties","updatePropertiesTimeout","echartsReact","getEchartsInstance","chartInstance","lastIds","item","sort","changed","clear","chartOption","setOption","onResize","timerResize","componentDidUpdate","onMouseMove","mouseDown","divResetButton","current","style","display","moved","lastX","offsetX","chartWidth","shift","onMouseDown","zr","_mousemove","on","onRangeChange","onMouseUp","off","onMouseWheel","pos","move","wheelDelta","updateDataTimer","onTouchStart","preventDefault","touches","originalEvent","pageX","lastWidth","abs","onTouchEnd","onTouchMove","fingerWidth","amount","chartHeight","createRef","divRef","locale","I18n","getLanguage","ChartOption","componentDidMount","componentWillUnmount","UNSAFE_componentWillReceiveProps","updateChart","installEventHandlers","getZr","_iobInstalled","renderChart","ref","echarts","notMerge","lazyUpdate","opts","renderer","onEvents","rendered","LinearProgress","noBorder","border_width","borderPadding","border_padding","offsetHeight","offsetWidth","setState","renderResetButton","Fab","size","className","classes","resetButton","onClick","resetButtonIcon","renderExportButton","exportColor","exportButton","base64","getDataURL","pixelRatio","window_bg","downloadLink","body","appendChild","href","target","download","padStart","click","alert","render","forceUpdate","background","borderColor","border_color","borderStyle","border_style","padding","withWidth","withStyles","maxHeight","maxWidth","overflow","zIndex","cursor","paddingTop","App","onReceiveMessage","message","chartData","createChartData","themeInstance","createTheme","Utils","queryHash","connected","themeName","getThemeName","getThemeType","noBackground","noBG","inEdit","edit","progressRef","translations","require","ownTranslations","keys","setTranslations","isIFrame","self","Connection","adapterName","onProgress","progress","PROGRESS","CONNECTING","READY","onReady","objects","scripts","setLanguage","systemLang","parent","postMessage","showError","ChartModel","reading","showProgress","isShow","palette","errorText","renderError","onClose","MD5","root","default","primary","key","withTheme","Boolean","hostname","match","version","host","Sentry","dsn","release","integrations","SentryIntegrations","build","ReactDOM","onThemeChange","_theme","getElementById","navigator","serviceWorker","ready","registration","unregister"],"mappings":"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EJC,YAAa,CACT,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,WAEJC,QAAS,CACL,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,WAEJC,KAAM,CACF,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,WAEJC,SAAU,CACN,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,WAEJC,MAAO,CACH,UACA,UACA,UACA,UACA,UACA,UACA,UACA,WAEJC,KAAM,CACF,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,WAEJC,MAAO,CACH,UACA,UACA,UACA,UACA,UACA,UACA,UACA,WAEJ,YAAa,CACT,UACA,UACA,UACA,UACA,UACA,UACA,UACA,WAEJ,YAAa,CACT,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,WAEJC,IAAK,CACD,UACA,UACA,UACA,UACA,UACA,UACA,WAEJ,aAAc,CACV,UACA,UACA,UACA,UACA,UACA,UACA,UACA,WAEJC,MAAO,CACH,UACA,UACA,UACA,UACA,UACA,UACA,UACA,WAEJC,MAAO,CAAC,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,WAC5IC,KAAM,CACF,UACA,UACA,UACA,UACA,UACA,WAEJ,YAAa,CACT,UACA,UACA,UACA,UACA,UACA,UACA,UACA,YAIR,SAASC,EAASC,GAId,OADAA,GAAOA,GAAO,IAAIpQ,YACVU,OAAS,EACN,IAAM0P,EAENA,EAknBf/K,EAAOC,QA9mBP,MACIC,YAAY8K,EAAQC,EAAWC,EAAezP,GAE1C,GADA+E,KAAKwK,OAASA,GACTxK,KAAKwK,OACN,MAAM,IAAIG,MAAM,sCAGpB3K,KAAK/E,OAASA,EAASmH,KAAKC,MAAMD,KAAKa,UAA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","file":"static/js/main.7eed7818.chunk.js","sourcesContent":["/**\r\n * Parse a query string into its parts.\r\n * Copied from @iobroker/adapter-react/Components/Utils\r\n * @param {string} query\r\n * @returns {Record<string, string | boolean | number>}\r\n */\r\nfunction parseQuery(query) {\r\n    query = (query || '').toString().replace(/^\\?/, '');\r\n    /** @type {Record<string, string | boolean | number>} */\r\n    const result = {};\r\n    query.split('&').forEach(part => {\r\n        part = part.trim();\r\n        if (part) {\r\n            const parts = part.split('=');\r\n            const attr = decodeURIComponent(parts[0]).trim();\r\n            if (parts.length > 1) {\r\n                result[attr] = decodeURIComponent(parts[1]);\r\n                if (result[attr] === 'true') {\r\n                    result[attr] = true;\r\n                } else if (result[attr] === 'false') {\r\n                    result[attr] = false;\r\n                } else {\r\n                    const f = parseFloat(result[attr]);\r\n                    if (f.toString() === result[attr]) {\r\n                        result[attr] = f;\r\n                    }\r\n                }\r\n            } else {\r\n                result[attr] = true;\r\n            }\r\n        }\r\n    });\r\n    return result;\r\n}\r\n\r\n/*\r\nfunction deParam(params, coerce) {\r\n    const obj = {};\r\n    const coerceTypes = {'true': true, 'false': false, 'null': null};\r\n\r\n    // Iterate over all name=value pairs.\r\n    params.replace(/\\+/g, ' ').split('&').forEach(v => {\r\n        const param = v.split('=');\r\n        let key = decodeURIComponent(param[0]);\r\n        let val;\r\n        let i = 0;\r\n\r\n        // If key is more complex than 'foo', like 'a[]' or 'a[b][c]', split it\r\n        // into its component parts.\r\n        let keys = key.split('][');\r\n        let keysLast = keys.length - 1;\r\n\r\n        // If the first keys part contains [ and the last ends with ], then []\r\n        // are correctly balanced.\r\n        if (/\\[/.test(keys[0]) && /]$/.test(keys[keysLast])) {\r\n            // Remove the trailing ] from the last keys part.\r\n            keys[keysLast] = keys[keysLast].replace(/]$/, '');\r\n\r\n            // Split first keys part into two parts on the [ and add them back onto\r\n            // the beginning of the keys array.\r\n            keys = keys.shift().split('[').concat(keys);\r\n\r\n            keysLast = keys.length - 1;\r\n        } else {\r\n            // Basic 'foo' style key.\r\n            keysLast = 0;\r\n        }\r\n\r\n        // Are we dealing with a name=value pair, or just a name?\r\n        if (param.length === 2) {\r\n            val = decodeURIComponent(param[1]);\r\n\r\n            // Coerce values.\r\n            if (coerce) {\r\n                val = val && !isNaN(val) && ((+val + '') === val) ? +val        // number\r\n                    : val === 'undefined' ? undefined         // undefined\r\n                        : coerceTypes[val] !== undefined ? coerceTypes[val] // true, false, null\r\n                            : val;                                                          // string\r\n            }\r\n\r\n            if (keysLast) {\r\n                let cur = obj;\r\n                // Complex key, build deep object structure based on a few rules:\r\n                // * The 'cur' pointer starts at the object top-level.\r\n                // * [] = array push (n is set to array length), [n] = array if n is\r\n                //   numeric, otherwise object.\r\n                // * If at the last keys part, set the value.\r\n                // * For each keys part, if the current level is undefined create an\r\n                //   object or array based on the type of the next keys part.\r\n                // * Move the 'cur' pointer to the next level.\r\n                // * Rinse & repeat.\r\n                for (; i <= keysLast; i++) {\r\n                    key = keys[i] === '' ? cur.length : keys[i];\r\n                    cur = cur[key] = i < keysLast\r\n                        ? cur[key] || (keys[i + 1] && isNaN(keys[i + 1]) ? {} : [])\r\n                        : val;\r\n                }\r\n\r\n            } else {\r\n                // Simple key, even simpler rules, since only scalars and shallow\r\n                // arrays are allowed.\r\n\r\n                if (Object.prototype.toString.call(obj[key]) === '[object Array]') {\r\n                    // val is already an array, so push on the next value.\r\n                    obj[key].push(val);\r\n                } else if ({}.hasOwnProperty.call(obj, key)) {\r\n                    // val isn't an array, but since a second value has been specified,\r\n                    // convert val into an array.\r\n                    obj[key] = [obj[key], val];\r\n                } else {\r\n                    // val is a scalar.\r\n                    obj[key] = val;\r\n                }\r\n            }\r\n        } else if (key) {\r\n            // No value was defined, so set something meaningful.\r\n            obj[key] = coerce\r\n                ? undefined\r\n                : '';\r\n        }\r\n    });\r\n\r\n    return obj;\r\n}\r\n*/\r\n// Do not forget to change normalizeConfig in src/utils/flotConverter.js too\r\nfunction normalizeConfig(config) {\r\n    if (config.lines) {\r\n        config.l = config.lines;\r\n        delete config.lines;\r\n    }\r\n\r\n    if (config._ids) {\r\n        const ids    = config._ids    ? config._ids.split(';')    : [];\r\n        const colors = config._colors ? config._colors.split(';') : [];\r\n        const names  = config._names  ? config._names.split(';')  : [];\r\n        const units  = config._units  ? config._units.split(';')  : [];\r\n        config.l = [];\r\n        for (let i = 0; i < ids.length; i++) {\r\n            config.l.push({\r\n                id:         ids[i],\r\n                offset:     0,\r\n                name:       names[i] || '',\r\n                aggregate:  'onchange',\r\n                color:      colors[i] || 'blue',\r\n                thickness:  config.strokeWidth || 1,\r\n                shadowsize: config.strokeWidth || 1,\r\n                min:        config.min || '',\r\n                max:        config.max || '',\r\n                unit:       units[i]   || ''\r\n            });\r\n        }\r\n        config.aggregateType = 'step';\r\n        config.aggregateSpan = 300;\r\n        config.relativeEnd   = 'now';\r\n    }\r\n\r\n    // convert art to aggregate (from flot)\r\n    if (config.l) {\r\n        for (let j = 0; j < config.l.length; j++) {\r\n            if (config.l[j].art) {\r\n                config.l[j].aggregate = config.l[j].art;\r\n                delete config.l[j].art;\r\n            }\r\n            if (config.instance && !config.l[j].instance) {\r\n                config.l[j].instance = config.instance;\r\n            }\r\n            config.l[j].yOffset   = parseFloat(config.l[j].yOffset)   || 0;\r\n            config.l[j].offset    = parseFloat(config.l[j].offset)    || 0;\r\n            config.l[j].validTime = parseFloat(config.l[j].validTime) || 0;\r\n        }\r\n    }\r\n\r\n    config.l = config.l || [];\r\n\r\n    // convert marks\r\n    if (config.m) {\r\n        config.marks = [];\r\n        for (let j = 0; j < config.m.length; j++) {\r\n            config.marks[j] = {\r\n                lineId:         config.m[j].l,\r\n                upperValueOrId: config.m[j].v,\r\n                lowerValueOrId: config.m[j].vl,\r\n                color:          config.m[j].c,\r\n                fill:           config.m[j].f,\r\n                ol:             config.m[j].t,\r\n                os:             config.m[j].s,\r\n                text:           config.m[j].d,\r\n                textPosition:   config.m[j].p,\r\n                textOffset:     config.m[j].py,\r\n                textColor:      config.m[j].fc,\r\n                textSize:       config.m[j].fs,\r\n            };\r\n        }\r\n        delete config.m;\r\n    }\r\n\r\n    config.marks = config.marks || [];\r\n\r\n    if (!config.l.length) {\r\n        config.l.push({id: '', unit: ''});\r\n    }\r\n\r\n    // Set default values\r\n    config.width        = config.width                   || '100%';\r\n    config.height       = config.height                  || '100%';\r\n    config.timeFormat   = config.timeFormat              || '';\r\n    config.useComma     = config.useComma    === 'true'  || config.useComma    === true;\r\n    config.zoom         = config.zoom        === 'true'  || config.zoom        === true;\r\n    config.export       = config.export      === 'true'  || config.export      === true;\r\n    config.grid_hideX   = config.grid_hideX  === 'true'  || config.grid_hideX  === true;\r\n    config.grid_hideY   = config.grid_hideY  === 'true'  || config.grid_hideY  === true;\r\n    config.hoverDetail  = config.hoverDetail === 'true'  || config.hoverDetail === true;\r\n    config.noLoader     = config.noLoader    === 'true'  || config.noLoader    === true;\r\n    config.noedit       = config.noedit      === 'true'  || config.noedit      === true;\r\n    config.animation    = parseInt(config.animation)     || 0;\r\n    config.afterComma   = config.afterComma === undefined ? 2 : parseInt(config.afterComma, 10);\r\n    config.timeType     = config.timeType || 'relative';\r\n    return config;\r\n}\r\n\r\nclass ChartModel {\r\n    constructor(socket, config, options) {\r\n        options = Object.assign({updateTimeout: 300}, options || {});\r\n        this.socket = socket;\r\n\r\n        this.updateTimeout    = options.updateTimeout || 300; // how often the new data will be requested by zoom and pan\r\n        this.serverSide       = options.serverSide || false; // if rendering is serverside\r\n\r\n        this.seriesData       = [];\r\n        this.ticks            = null;\r\n        this.liveInterval     = null;\r\n\r\n        this.navOptions       = {};\r\n\r\n        //this.subscribes       = [];\r\n        //this.subscribed       = false;\r\n        this.sessionId        = 1;\r\n        this.updateInterval   = null; // update interval by time\r\n        this.presetSubscribed = false; // Is preset subscribed yet or not\r\n\r\n        this.defaultHistory   = '';\r\n\r\n        this.onUpdateFunc     = null;\r\n        this.onReadingFunc    = null;\r\n        this.onErrorFunc      = null;\r\n        this.objectPromises   = {};\r\n        this.debug            = false;\r\n        this.zoomData         = null;\r\n\r\n        if (!this.serverSide) {\r\n            this.lastHash         = window.location.hash;\r\n\r\n            if (!config) {\r\n                this.onHashInstalled = true;\r\n                this.onHashChangeBound = this.onHashChange.bind(this);\r\n                window.addEventListener('hashchange', this.onHashChangeBound, false);\r\n            }\r\n            this.onPresetUpdateBound = this.onPresetUpdate.bind(this);\r\n        }\r\n\r\n        this.socket.getSystemConfig()\r\n            .then(systemConfig => {\r\n                this.systemConfig = systemConfig && systemConfig.common ? systemConfig.common : {};\r\n                this.defaultHistory = this.systemConfig.defaultHistory;\r\n                return this.analyseAndLoadConfig(config);\r\n            });\r\n    }\r\n\r\n    analyseAndLoadConfig(config) {\r\n        if (config) {\r\n            if (typeof config === 'string') {\r\n                this.preset = config;\r\n            } else {\r\n                this.config = normalizeConfig(config);\r\n            }\r\n        } else {\r\n            const query = parseQuery(window.location.search); // Utils.parseQuery\r\n\r\n            this.debug = query.debug === true || query.debug === 'true' || query.debug === 1 || query.debug === '1';\r\n\r\n            if (query.preset && typeof query.preset === 'string') {\r\n                this.preset = query.preset;\r\n            } else {\r\n                const hQuery = parseQuery((window.location.hash || '').toString().replace(/^#/, '')); // Utils.parseQuery\r\n                if (hQuery.data) {\r\n                    try {\r\n                        hQuery.data = JSON.parse(hQuery.data);\r\n                    } catch (e) {\r\n                        hQuery.data = {};\r\n                    }\r\n                }\r\n                if (query.data) {\r\n                    try {\r\n                        query.data = JSON.parse(query.data);\r\n                    } catch (e) {\r\n                        query.data = {};\r\n                    }\r\n                }\r\n                // search ID and range\r\n                const _config = Object.assign(query.data || {}, hQuery.data || {}, true);\r\n                if (hQuery.noLoader !== undefined) {\r\n                    _config.noLoader = hQuery.noLoader === true || hQuery.noLoader === 'true' || hQuery.noLoader === 1 || hQuery.noLoader === '1';\r\n                }\r\n                if (query.noLoader !== undefined) {\r\n                    _config.noLoader = query.noLoader === true || query.noLoader === 'true' || query.noLoader === 1 || query.noLoader === '1';\r\n                }\r\n                this.config = normalizeConfig(_config);\r\n                //console.log(this.config);\r\n            }\r\n        }\r\n\r\n        this.seriesData = [];\r\n\r\n        if (this.updateInterval) {\r\n            clearInterval(this.updateInterval);\r\n            this.updateInterval = null;\r\n        }\r\n\r\n        if (this.preset) {\r\n            if ((!this.preset.startsWith('echarts.') && !this.preset.startsWith('flot.')) || !this.preset.includes('.')) {\r\n                this.preset = 'echarts.0.' + this.preset;\r\n            }\r\n\r\n            this.socket.getObject(this.preset)\r\n                .then(obj => {\r\n                    if (!obj || !obj.native || !obj.native.data || obj.type !== 'chart') {\r\n                        return console.error(`[ChartModel] Invalid object ${this.preset}: ${JSON.stringify(obj)}`);\r\n                    }\r\n                    this.config          = normalizeConfig(obj.native.data);\r\n                    this.config.useComma = this.config.useComma === undefined ? this.systemConfig.isFloatComma === true || this.systemConfig.isFloatComma === 'true' : this.config.useComma === 'true' || this.config.useComma === true;\r\n                    this.config.lang     = this.systemConfig.language;\r\n                    this.config.live     = parseInt(this.config.live, 10) || 0;\r\n                    this.config.debug    = this.debug;\r\n\r\n                    this.readData();\r\n\r\n                    // subscribe on preset changes\r\n                    if (!this.serverSide && this.presetSubscribed !== this.preset) {\r\n                        this.presetSubscribed && this.socket.unsubscribeObject(this.presetSubscribed, this.onPresetUpdateBound);\r\n                        this.presetSubscribed = this.preset;\r\n                        this.socket.subscribeObject(this.preset, this.onPresetUpdateBound);\r\n                    }\r\n                    if (!this.serverSide && this.config.live && (!this.zoomData|| !this.zoomData.stopLive)) {\r\n                        this.updateInterval = setInterval(() => this.readData(), this.config.live * 1000);\r\n                    }\r\n                });\r\n        } else {\r\n            this.config.useComma = this.config.useComma === undefined ? this.systemConfig.isFloatComma === true || this.systemConfig.isFloatComma === 'true' : this.config.useComma === 'true' || this.config.useComma === true;\r\n            this.config.lang     = this.systemConfig.language;\r\n            this.config.live     = parseInt(this.config.live, 10) || 0;\r\n            this.config.debug    = this.debug;\r\n            this.readData();\r\n            if (!this.serverSide && this.config.live && (!this.zoomData|| !this.zoomData.stopLive)) {\r\n                this.updateInterval = setInterval(() => this.readData(), this.config.live * 1000);\r\n            }\r\n        }\r\n    }\r\n\r\n    onHashChange() {\r\n        if (this.lastHash !== window.location.hash) {\r\n            this.lastHash = window.location.hash;\r\n            this.analyseAndLoadConfig();\r\n        }\r\n    };\r\n\r\n    onPresetUpdate(id, obj) {\r\n        if (id !== this.preset) {\r\n            return;\r\n        }\r\n        this.presetUpdateTimeout && clearTimeout(this.presetUpdateTimeout);\r\n        this.presetUpdateTimeout = setTimeout(() => {\r\n            this.presetUpdateTimeout = null;\r\n            let newConfig;\r\n            if (obj) {\r\n                newConfig = normalizeConfig(obj.native.data);\r\n            } else {\r\n                newConfig = normalizeConfig({});\r\n            }\r\n            if (JSON.stringify(newConfig) !== JSON.stringify(this.config)) {\r\n                this.config = newConfig;\r\n                this.updateInterval && clearInterval(this.updateInterval);\r\n                this.updateInterval = null;\r\n\r\n                if (this.config.live && (!this.zoomData|| !this.zoomData.stopLive)) {\r\n                    this.updateInterval = setInterval(() => this.readData(), this.config.live * 1000);\r\n                }\r\n\r\n                this.readData();\r\n            }\r\n        }, 100);\r\n    };\r\n\r\n    setNewRange(options) {\r\n        this.debug && console.log(`[ChartModel] [${new Date().toISOString()}] setNewRange: ${JSON.stringify(options)}`);\r\n\r\n        if (!options) {\r\n            if (this.zoomData) {\r\n                this.zoomData = null;\r\n                this.readOnZoomTimeout && clearTimeout(this.readOnZoomTimeout);\r\n                this.readOnZoomTimeout = setTimeout(() => {\r\n                    this.readOnZoomTimeout = null;\r\n                    if (this.config.live && (!this.zoomData || !this.zoomData.stopLive)) {\r\n                        console.log('Restore update');\r\n                        this.updateInterval && clearInterval(this.updateInterval);\r\n                        this.updateInterval = setInterval(() => this.readData(), this.config.live * 1000);\r\n                    }\r\n                    this.readData();\r\n                }, this.updateTimeout);\r\n            }\r\n        } else if (options.stopLive) {\r\n            this.zoomData = this.zoomData || {};\r\n            this.zoomData.stopLive = true;\r\n            if (this.updateInterval) {\r\n                console.log('Clear interval');\r\n                clearInterval(this.updateInterval);\r\n                this.updateInterval = null;\r\n            }\r\n        } else {\r\n            // options = {start, end}\r\n            const stopLive = this.zoomData && this.zoomData.stopLive;\r\n            if (stopLive) {\r\n                delete this.zoomData.stopLive;\r\n            }\r\n            if (!this.zoomData || JSON.stringify(this.zoomData) !== JSON.stringify(options)) {\r\n                this.zoomData = options;\r\n                if (stopLive) {\r\n                    this.zoomData.stopLive = true;\r\n                }\r\n                this.readOnZoomTimeout && clearTimeout(this.readOnZoomTimeout);\r\n                this.readOnZoomTimeout = setTimeout(() => {\r\n                    this.readOnZoomTimeout = null;\r\n                    this.readData();\r\n                }, this.updateTimeout);\r\n            } else if (stopLive) {\r\n                this.zoomData.stopLive = true;\r\n            }\r\n        }\r\n    }\r\n\r\n    destroy() {\r\n        /*if (this.subscribed) {\r\n            this.subscribes.forEach(id => this.socket.unsubscribeState(id, this.onStateChange));\r\n            this.subscribes = [];\r\n            this.subscribed = null;\r\n        }*/\r\n        if (this.readOnZoomTimeout) {\r\n            clearTimeout(this.readOnZoomTimeout);\r\n            this.readOnZoomTimeout = null;\r\n        }\r\n        if (this.presetUpdateTimeout) {\r\n            clearTimeout(this.presetUpdateTimeout);\r\n            this.presetUpdateTimeout = null;\r\n        }\r\n        if (this.presetSubscribed) {\r\n            this.socket.unsubscribeObject(this.presetSubscribed, this.onPresetUpdateBound);\r\n            this.presetSubscribed = null;\r\n        }\r\n        if (this.updateInterval) {\r\n            clearInterval(this.updateInterval);\r\n            this.updateInterval = null;\r\n        }\r\n        if (!this.serverSide) {\r\n            this.onHashInstalled && window.removeEventListener('hashchange', this.onHashChangeBound, false);\r\n            this.onHashInstalled = false;\r\n        }\r\n    }\r\n\r\n    onUpdate(cb) {\r\n        this.onUpdateFunc = cb;\r\n    }\r\n\r\n    onReading(cb) {\r\n        this.onReadingFunc = cb;\r\n    }\r\n\r\n    onError(cb) {\r\n        this.onErrorFunc = cb;\r\n    }\r\n\r\n    getConfig() {\r\n        return this.config;\r\n    }\r\n\r\n    getSystemConfig() {\r\n        return this.systemConfig;\r\n    }\r\n\r\n    setConfig(config) {\r\n        this.analyseAndLoadConfig(config);\r\n    }\r\n\r\n    getStartStop(index, step) {\r\n        let option = {};\r\n        let end;\r\n        let start;\r\n        let _now;\r\n        this.config.l[index].offset = this.config.l[index].offset || 0;\r\n\r\n        const isMonthRange = typeof this.config.range === 'string' && this.config.range.includes('m');\r\n\r\n        // check config range\r\n        if (isMonthRange && this.config.l.length > 1) {\r\n            const monthRange = parseInt(this.config.range, 10) || 1;\r\n            for (let a = 0; a < this.config.l.length; a++) {\r\n                if (this.config.l[a].offset && this.config.l[a].offset !== 0) {\r\n                    // Check what the month has first index\r\n                    _now = this.addTime(this.now, this.config.l[0].offset);\r\n                    const minusMonth = new Date(_now);\r\n                    minusMonth.setMonth(minusMonth.getMonth() - monthRange);\r\n                    this.config.range = Math.floor((_now - minusMonth.getTime()) / 60000) + '';\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n\r\n        if (!step) {\r\n            if (this.zoomData) {\r\n                start = this.zoomData.start;\r\n                end   = this.zoomData.end;\r\n            } else\r\n            if (this.config.timeType === 'static') {\r\n                let startTime;\r\n                let endTime;\r\n                if (this.config.start_time !== undefined) {\r\n                    startTime = this.config.start_time.split(':').map(Number);\r\n                } else {\r\n                    startTime = [0, 0];\r\n                }\r\n\r\n                if (this.config.end_time !== undefined) {\r\n                    endTime = this.config.end_time.split(':').map(Number);\r\n                } else {\r\n                    endTime = [24, 0];\r\n                }\r\n\r\n                // offset is in seconds\r\n                start = new Date(this.config.start).setHours(startTime[0], startTime[1]);\r\n                end   = new Date(this.config.end).setHours(endTime[0],   endTime[1]);\r\n                start = this.addTime(start, this.config.l[index].offset);\r\n                end   = this.addTime(end,   this.config.l[index].offset);\r\n            }\r\n            else {\r\n                this.config.relativeEnd = this.config.relativeEnd || 'now';\r\n\r\n                if (this.config.relativeEnd === 'now') {\r\n                    _now = new Date(this.now);\r\n                } else if (this.config.relativeEnd.indexOf('minute') !== -1) {\r\n                    const minutes = parseInt(this.config.relativeEnd, 10) || 1;\r\n                    _now = new Date(this.now);\r\n                    _now.setMinutes(Math.floor(_now.getMinutes() / minutes) * minutes + minutes);\r\n                    _now.setSeconds(0);\r\n                    _now.setMilliseconds(0);\r\n                }  else if (this.config.relativeEnd.indexOf('hour') !== -1) {\r\n                    const hours = parseInt(this.config.relativeEnd, 10) || 1;\r\n                    _now = new Date(this.now);\r\n                    _now.setHours(Math.floor(_now.getHours() / hours) * hours + hours);\r\n                    _now.setMinutes(0);\r\n                    _now.setSeconds(0);\r\n                    _now.setMilliseconds(0);\r\n                } else if (this.config.relativeEnd === 'today') {\r\n                    _now = new Date(this.now);\r\n                    _now.setDate(_now.getDate() + 1);\r\n                    _now.setHours(0);\r\n                    _now.setMinutes(0);\r\n                    _now.setSeconds(0);\r\n                    _now.setMilliseconds(0);\r\n                } else if (this.config.relativeEnd === 'weekUsa') {\r\n                    //const week = parseInt(config.relativeEnd, 10) || 1;\r\n                    _now = new Date(this.now);\r\n                    _now.setDate(_now.getDate() - _now.getDay() + 7);\r\n                    _now.setHours(0);\r\n                    _now.setMinutes(0);\r\n                    _now.setSeconds(0);\r\n                    _now.setMilliseconds(0);\r\n                } else if (this.config.relativeEnd === 'weekEurope') {\r\n                    //const _week = parseInt(config.relativeEnd, 10) || 1;\r\n                    _now = new Date(this.now);\r\n                    // If\r\n                    if (_now.getDay() === 0) {\r\n                        _now.setDate(_now.getDate() + 1);\r\n                    } else {\r\n                        _now.setDate(_now.getDate() - _now.getDay() + 8);\r\n                    }\r\n                    _now.setHours(0);\r\n                    _now.setMinutes(0);\r\n                    _now.setSeconds(0);\r\n                    _now.setMilliseconds(0);\r\n                } else if (this.config.relativeEnd === 'month') {\r\n                    _now = new Date(this.now);\r\n                    _now.setMonth(_now.getMonth() + 1);\r\n                    _now.setDate(1);\r\n                    _now.setHours(0);\r\n                    _now.setMinutes(0);\r\n                    _now.setSeconds(0);\r\n                    _now.setMilliseconds(0);\r\n                } else if (this.config.relativeEnd === 'year') {\r\n                    _now = new Date(this.now);\r\n                    _now.setFullYear(_now.getFullYear() + 1);\r\n                    _now.setMonth(0);\r\n                    _now.setDate(1);\r\n                    _now.setHours(0);\r\n                    _now.setMinutes(0);\r\n                    _now.setSeconds(0);\r\n                    _now.setMilliseconds(0);\r\n                }\r\n\r\n                this.config.range = this.config.range || '30m';\r\n\r\n                end   = this.addTime(_now, this.config.l[index].offset);\r\n                start = this.addTime(end,  this.config.range, false, true);\r\n            }\r\n\r\n            option = {\r\n                start,\r\n                end,\r\n                ignoreNull: this.config.l[index].ignoreNull === undefined ? this.config.ignoreNull : this.config.l[index].ignoreNull,\r\n                aggregate:  this.config.l[index].aggregate || this.config.aggregate || 'minmax',\r\n                from:       false,\r\n                ack:        false,\r\n                q:          false,\r\n                addID:      false,\r\n            };\r\n\r\n            if (this.config.aggregateType === 'step') {\r\n                option.step = this.config.aggregateSpan * 1000;\r\n            } else if (this.config.aggregateType === 'count') {\r\n                option.count = this.config.aggregateSpan || 300;\r\n            }\r\n\r\n            this.config.start = start;\r\n            this.config.end   = end;\r\n\r\n            return option;\r\n        } else {\r\n            if (this.zoomData) {\r\n                start = this.zoomData.start;\r\n                end = this.zoomData.end;\r\n            } else {\r\n                end   = this.addTime(this.now, this.config.l[index].offset);\r\n                start = end - step;\r\n            }\r\n\r\n            option = {\r\n                start,\r\n                end,\r\n                ignoreNull: this.config.l[index].ignoreNull === undefined ? this.config.ignoreNull : this.config.l[index].ignoreNull,\r\n                aggregate:  this.config.l[index].aggregate || this.config.aggregate || 'minmax',\r\n                count:      1,\r\n                from:       false,\r\n                ack:        false,\r\n                q:          false,\r\n                addID:      false,\r\n            };\r\n\r\n            this.config.start = this.addTime(end, this.config.range, false, true);\r\n            this.config.end   = end;\r\n\r\n            return option;\r\n        }\r\n    }\r\n\r\n    readOneChart(id, instance, index, cb) {\r\n        const option = this.getStartStop(index);\r\n        option.instance  = instance;\r\n        option.sessionId = this.sessionId;\r\n\r\n        //console.log(JSON.stringify(option));\r\n        this.debug && console.log('[ChartModel] ' + new Date(option.start) + ' - ' + new Date(option.end));\r\n\r\n        this.socket.getHistoryEx(id, option)\r\n            .then(res => {\r\n                if (this.sessionId && res.sessionId && res.sessionId !== this.sessionId) {\r\n                    return console.warn(`[ChartModel] Ignore request with sessionId=${res.sessionId}, actual is ${this.sessionId}`);\r\n                }\r\n\r\n                if (res && res.values) {\r\n                    //option.ignoreNull = (config.l[index].ignoreNull === undefined) ? (config.ignoreNull === 'true' || config.ignoreNull === true) : (config.l[index].ignoreNull === 'true' || config.l[index].ignoreNull === true);\r\n                    option.yOffset = this.config.l[index].yOffset;\r\n                    const values = res.values;\r\n\r\n                    this.seriesData[index] = []; // not really needed\r\n                    const _series = this.seriesData[index];\r\n\r\n                    for (let i = 0; i < values.length; i++) {\r\n                        // Convert boolean values to numbers\r\n                        if (values[i].val === 'true' || values[i].val === true) {\r\n                            values[i].val = 1;\r\n                        } else if (values[i].val === 'false' || values[i].val === false) {\r\n                            values[i].val = 0;\r\n                        }\r\n                        if (typeof values[i].val === 'string') {\r\n                            values[i].val = parseFloat(values[i].val);\r\n                        }\r\n\r\n                        _series.push({value: [values[i].ts, values[i].val !== null ? values[i].val + option.yOffset : null]});\r\n                    }\r\n\r\n                    // add start and end\r\n                    if (_series.length) {\r\n                        if (_series[0].value[0] > option.start) {\r\n                            _series.unshift({value: [option.start, null], exact: false});\r\n                        }\r\n                        const last = _series[_series.length - 1];\r\n                        if (last.value[0] < option.end) {\r\n                            if (this.config.l[index].validTime) {\r\n                                // If last value is not older than X seconds, assume it is still the same\r\n                                if (option.end - this.config.l[index].validTime * 1000 <= last.value[0]) {\r\n                                    _series.push({value: [option.end, last.value[1]], exact: false});\r\n                                } else {\r\n                                    _series.push({value: [option.end, null], exact: false});\r\n                                }\r\n                            } else {\r\n                                _series.push({value: [option.end, null], exact: false});\r\n                            }\r\n                        }\r\n                    } else {\r\n                        _series.push({value: [option.start, null], exact: false});\r\n                        _series.push({value: [option.end,   null], exact: false});\r\n                    }\r\n\r\n                    // free memory\r\n                    res.values = null;\r\n                    res = null;\r\n                }\r\n\r\n                return Promise.resolve();\r\n            })\r\n            .catch(err => err && console.error('[ChartModel] ' + err))\r\n            .then(() => cb(id, index))\r\n    }\r\n\r\n    _readObject(id) {\r\n        if (!this.objectPromises[id]) {\r\n            this.objectPromises[id] = this.socket.getObject(id);\r\n        }\r\n        return this.objectPromises[id];\r\n    }\r\n\r\n    _readOneLine(index, cb) {\r\n        return this._readObject(this.config.l[index].id)\r\n            .then(obj => {\r\n                if (obj && obj.common) {\r\n                    this.config.l[index].name = this.config.l[index].name || obj.common.name;\r\n                    this.config.l[index].unit = this.config.l[index].unit || (obj.common.unit ? obj.common.unit.replace('', '') : '');\r\n                    this.config.l[index].type = obj.common.type;\r\n                    if (this.config.l[index].chartType === 'auto') {\r\n                        this.config.l[index].chartType = obj.common.type === 'boolean' ? 'steps' : 'line';\r\n                        this.config.l[index].aggregate = obj.common.type === 'boolean' ? 'onchange' : 'minmax';\r\n                    }\r\n                }\r\n\r\n                return Promise.resolve();\r\n            })\r\n            .catch(e => {\r\n                console.error(`[ChartModel] Cannot read object ${this.config.l[index].id}: ${e}`);\r\n                return Promise.resolve();\r\n            })\r\n            .then(() => {\r\n                this.config.l[index].name = this.config.l[index].name || this.config.l[index].id;\r\n                this.config.l[index].unit = this.config.l[index].unit || '';\r\n                if (this.config.l[index].chartType === 'auto') {\r\n                    this.config.l[index].chartType = 'line';\r\n                    this.config.l[index].aggregate = 'minmax';\r\n                }\r\n                if (typeof this.config.l[index].name === 'object') {\r\n                    this.config.l[index].name = this.config.l[index].name[this.systemConfig.language] || this.config.l[index].name.en;\r\n                }\r\n                this.readOneChart(this.config.l[index].id, this.config.l[index].instance || this.defaultHistory, index, cb);\r\n            });\r\n    }\r\n\r\n    _readData(cb, j) {\r\n        j = j || 0;\r\n        if (j >= this.config.l.length) {\r\n            return cb();\r\n        } else {\r\n            if (this.config.l[j] !== '' && this.config.l[j] !== undefined) {\r\n                this.seriesData.push([]);\r\n            }\r\n\r\n            this._readOneLine(j, () =>\r\n                setTimeout(() => this._readData(cb, j + 1), 10));\r\n        }\r\n    }\r\n\r\n    readTicks(cb) {\r\n        if (!this.config.ticks) {\r\n            cb(null);\r\n        } else {\r\n            const index = 0;\r\n            const option = JSON.parse(JSON.stringify(this.getStartStop(index)));\r\n            option.instance  = this.config.l[index].instance || this.defaultHistory;\r\n            option.sessionId = this.sessionId;\r\n            option.aggregate = 'onchange';\r\n\r\n            this.debug && console.log('[ChartModel] Ticks: ' + new Date(option.start) + ' - ' + new Date(option.end));\r\n\r\n            this.socket.getHistoryEx(this.config.ticks, option)\r\n                .then(res => {\r\n                    if (this.sessionId && res.sessionId && res.sessionId !== this.sessionId) {\r\n                        return console.warn(`[ChartModel] Ignore request with sessionId=${res.sessionId}, actual is ${this.sessionId}`);\r\n                    }\r\n\r\n                    if (res && res.values) {\r\n                        const _series = this.ticks || [];\r\n                        if (this.ticks && this.ticks.length) {\r\n                            this.ticks.splice(0, this.ticks.length);\r\n                        }\r\n\r\n                        const values = res.values;\r\n\r\n                        for (let i = 0; i < values.length; i++) {\r\n                            // if less 2000.01.01 00:00:00\r\n                            //if (values[i].ts < 946681200000) {\r\n                            //    values[i].ts = values[i].ts * 1000;\r\n                            //}\r\n\r\n                            if (values[i].val !== null) {\r\n                                _series.push({value: [values[i].ts, values[i].val]});\r\n                            }\r\n                        }\r\n\r\n                        // add start and end\r\n                        if (_series.length) {\r\n                            if (_series[0][0] > option.start) {\r\n                                _series.unshift({value: [option.start, '']});\r\n                            }\r\n                            if (_series[_series.length - 1][0] < option.end) {\r\n                                _series.push({value: [option.end, '']});\r\n                            }\r\n                        } else {\r\n                            _series.push({value: [option.start, '']});\r\n                            _series.push({value: [option.end,   '']});\r\n                        }\r\n                        // free memory\r\n                        res.values = null;\r\n                        res = null;\r\n\r\n                        this.ticks = _series;\r\n                    }\r\n                    return Promise.resolve();\r\n                })\r\n                .catch(e => console.error(`[ChartModel] ${e}`))\r\n                .then(() => cb && cb(this.ticks));\r\n        }\r\n    }\r\n\r\n    readValue(id, index, cb) {\r\n        this.socket.getState(id)\r\n            .then(state => {\r\n                if (state) {\r\n                    cb(index, parseFloat(state.val) || 0);\r\n                } else {\r\n                    cb(index, 0);\r\n                }\r\n            })\r\n            .catch(e => {\r\n                console.error(`[ChartModel] ${e}`);\r\n                cb(index, 0);\r\n            });\r\n    }\r\n\r\n    readMarkings(cb, m) {\r\n        m = m || 0;\r\n        if (!this.config.marks || !this.config.marks.length || m >= this.config.marks.length) {\r\n            return cb();\r\n        } else {\r\n            // read markings\r\n            return new Promise(resolve => {\r\n                if ((this.config.marks[m].upperValueOrId || this.config.marks[m].upperValueOrId === 0) &&\r\n                    parseFloat(this.config.marks[m].upperValueOrId).toString() !== this.config.marks[m].upperValueOrId.toString().replace(/\\.0*$/, '') &&\r\n                    this.config.marks[m].upperValueOrId.toString().includes('.')\r\n                ) {\r\n                    /*if (!this.subscribes.includes(this.config.marks[m].upperValueOrId)) {\r\n                        this.subscribes.push(this.config.marks[m].upperValueOrId);\r\n                    }*/\r\n\r\n                    this.socket.getState(this.config.marks[m].upperValueOrId)\r\n                        .then(state => {\r\n                            if (state && state.val !== undefined && state.val !== null) {\r\n                                this.config.marks[m].upperValue = parseFloat(state.val) || 0;\r\n                            } else {\r\n                                this.config.marks[m].upperValue = null;\r\n                            }\r\n                            resolve();\r\n                        });\r\n                } else {\r\n                    resolve();\r\n                }\r\n            })\r\n                .then(() => new Promise(resolve => {\r\n                    if ((this.config.marks[m].lowerValueOrId || this.config.marks[m].lowerValueOrId === 0) && parseFloat(this.config.marks[m].lowerValueOrId).toString() !== this.config.marks[m].lowerValueOrId.replace(/\\.0*$/, '') && this.config.marks[m].lowerValueOrId.includes('.')) {\r\n                        /*if (!this.subscribes.includes(this.config.marks[m].upperValueOrId)) {\r\n                            this.subscribes.push(this.config.marks[m].upperValueOrId);\r\n                        }*/\r\n\r\n                        this.socket.getState(this.config.marks[m].lowerValueOrId)\r\n                            .then(state => {\r\n                                if (state && state.val !== undefined && state.val !== null) {\r\n                                    this.config.marks[m].lowerValue = parseFloat(state.val) || 0;\r\n                                } else {\r\n                                    this.config.marks[m].lowerValue = null;\r\n                                }\r\n                                resolve();\r\n                            });\r\n                    } else {\r\n                        resolve();\r\n                    }\r\n                }))\r\n                .then(() =>\r\n                    setTimeout(() => this.readMarkings(cb, m + 1), 0));\r\n        }\r\n    }\r\n\r\n    /*subscribeAll(subscribes, cb, s) {\r\n        s = s || 0;\r\n\r\n        if (!subscribes || !subscribes.length || s >= subscribes.length) {\r\n            cb();\r\n        } else {\r\n            this.socket.subscribeState(subscribes[s], this.onStateChange);\r\n            setTimeout(() => this.subscribeAll(subscribes, cb, s + 1), 0);\r\n        }\r\n    }\r\n\r\n    onStateChange = (id, state) => {\r\n        if (!this.seriesData || !this.config || !this.config.m) {\r\n            return;\r\n        }\r\n\r\n        this.debug && console.log('State update ' + id + ' - ' + state.val);\r\n\r\n        for (let m = 0; m < this.config.m.length; m++) {\r\n            if (this.config.m[m].oid === id) {\r\n                this.config.m[m].v = parseFloat(state.val) || 0;\r\n            }\r\n            if (this.config.m[m].oidl === id) {\r\n                this.config.m[m].vl = parseFloat(state.val) || 0;\r\n            }\r\n        }\r\n        //chart.update(null, ;config.m);\r\n    };*/\r\n\r\n    addTime(time, offset, plusOrMinus, isOffsetInMinutes) {\r\n        time = new Date(time);\r\n\r\n        if (typeof offset === 'string') {\r\n            if (offset[1] === 'm') {\r\n                offset = parseInt(offset, 10);\r\n                time.setMonth(plusOrMinus ? time.getMonth() + offset : time.getMonth() - offset);\r\n                time = time.getTime();\r\n            } else if (offset[1] === 'y') {\r\n                offset = parseInt(offset, 10);\r\n                time.setFullYear(plusOrMinus ? time.getFullYear() + offset : time.getFullYear() - offset);\r\n                time = time.getTime();\r\n            } else {\r\n                time  = time.getTime();\r\n                if (isOffsetInMinutes) {\r\n                    if (plusOrMinus) {\r\n                        time += (parseInt(offset, 10) || 0) * 60000;\r\n                    } else {\r\n                        time -= (parseInt(offset, 10) || 0) * 60000;\r\n                    }\r\n\r\n                } else {\r\n                    if (plusOrMinus) {\r\n                        time += (parseInt(offset, 10) || 0) * 1000;\r\n                    } else {\r\n                        time -= (parseInt(offset, 10) || 0) * 1000;\r\n                    }\r\n                }\r\n            }\r\n        } else {\r\n            time  = time.getTime();\r\n            if (isOffsetInMinutes) {\r\n                if (plusOrMinus) {\r\n                    time += (parseInt(offset, 10) || 0) * 60000;\r\n                } else {\r\n                    time -= (parseInt(offset, 10) || 0) * 60000;\r\n                }\r\n\r\n            } else {\r\n                if (plusOrMinus) {\r\n                    time += (parseInt(offset, 10) || 0) * 1000;\r\n                } else {\r\n                    time -= (parseInt(offset, 10) || 0) * 1000;\r\n                }\r\n            }\r\n        }\r\n        return time;\r\n    }\r\n\r\n    readData() {\r\n        if (this.readOnZoomTimeout) {\r\n            clearTimeout(this.readOnZoomTimeout);\r\n            this.readOnZoomTimeout = null;\r\n        }\r\n\r\n        this.now = Date.now();\r\n        console.log('Read till ' + new Date(this.now));\r\n        this.sessionId = this.sessionId || 0;\r\n        this.sessionId++;\r\n        if (this.sessionId > 0xFFFFFF) {\r\n            this.sessionId = 1;\r\n        }\r\n\r\n        if (this.config.l) {\r\n            this.onReadingFunc && this.onReadingFunc(true);\r\n\r\n            // todo\r\n//            if (config.renderer === 'pie' || (config.renderer === 'bar' && config._ids.length > 1)) {\r\n//\r\n//                seriesData = [[]];\r\n//                for (const j = 0; j < config._ids.length; j++) {\r\n//                    readOneValue(config._ids[j], j, function (_id, _index, value) {\r\n//                        if (config.renderer === 'pie') {\r\n//                            seriesData[0][_index] = {label: config.l[_index].name, data: value};\r\n//                        } else {\r\n//                            seriesData[0][_index] = [config.l[_index].name, value];\r\n//                        }\r\n//                        if (_index === config._ids.length - 1) {\r\n//                            graphCreate(divId, );\r\n//                        }\r\n//                    });\r\n//                }\r\n//            } else {\r\n            this.seriesData = [];\r\n            this._readData(() =>\r\n                this.readTicks(_ticks =>\r\n                    this.readMarkings(() => {\r\n                        /*if (!this.subscribed) {\r\n                            this.subscribed = true;\r\n                            this.subscribeAll(this.subscribes, () =>\r\n                                this.onUpdateFunc(this.seriesData));\r\n                        } else {*/\r\n                            this.onUpdateFunc(this.seriesData);\r\n                        //}\r\n                    })));\r\n        } else {\r\n            this.onErrorFunc && this.onErrorFunc('No config provided');\r\n            this.onReadingFunc && this.onReadingFunc(false);\r\n        }\r\n    }\r\n}\r\n\r\nmodule.exports = ChartModel;\r\n","const THEMES = {\r\n    azul: [\r\n        '#f2385a',\r\n        '#f5a503',\r\n        '#4ad9d9',\r\n        '#f7879c',\r\n        '#c1d7a8',\r\n        '#4dffd2',\r\n        '#fccfd7',\r\n        '#d5f6f6'\r\n    ],\r\n    'bee-inspired': [\r\n        '#001727',\r\n        '#805500',\r\n        '#ffff00',\r\n        '#ffd11a',\r\n        '#f2d71f',\r\n        '#f2be19',\r\n        '#f3a81a',\r\n        '#fff5cc'\r\n    ],\r\n    'blue': [\r\n        '#1790cf',\r\n        '#1bb2d8',\r\n        '#99d2dd',\r\n        '#88b0bb',\r\n        '#1c7099',\r\n        '#038cc4',\r\n        '#75abd0',\r\n        '#afd6dd'\r\n    ],\r\n    infographic: [\r\n        '#C1232B',\r\n        '#27727B',\r\n        '#FCCE10',\r\n        '#E87C25',\r\n        '#B5C334',\r\n        '#FE8463',\r\n        '#9BCA63',\r\n        '#FAD860',\r\n        '#F3A43B',\r\n        '#60C0DD',\r\n        '#D7504B',\r\n        '#C6E579',\r\n        '#F4E001',\r\n        '#F0805A',\r\n        '#26C0C0'\r\n    ],\r\n    vintage: [\r\n        '#d87c7c',\r\n        '#919e8b',\r\n        '#d7ab82',\r\n        '#6e7074',\r\n        '#61a0a8',\r\n        '#efa18d',\r\n        '#787464',\r\n        '#cc7e63',\r\n        '#724e58',\r\n        '#4b565b'\r\n    ],\r\n    dark: [\r\n        '#dd6b66',\r\n        '#759aa0',\r\n        '#e69d87',\r\n        '#8dc1a9',\r\n        '#ea7e53',\r\n        '#eedd78',\r\n        '#73a373',\r\n        '#73b9bc',\r\n        '#7289ab',\r\n        '#91ca8c',\r\n        '#f49f42'\r\n    ],\r\n    macarons: [\r\n        '#2ec7c9',\r\n        '#b6a2de',\r\n        '#5ab1ef',\r\n        '#ffb980',\r\n        '#d87a80',\r\n        '#8d98b3',\r\n        '#e5cf0d',\r\n        '#97b552',\r\n        '#95706d',\r\n        '#dc69aa',\r\n        '#07a2a4',\r\n        '#9a7fd1',\r\n        '#588dd5',\r\n        '#f5994e',\r\n        '#c05050',\r\n        '#59678c',\r\n        '#c9ab00',\r\n        '#7eb00a',\r\n        '#6f5553',\r\n        '#c14089'\r\n    ],\r\n    shine: [\r\n        '#c12e34',\r\n        '#e6b600',\r\n        '#0098d9',\r\n        '#2b821d',\r\n        '#005eaa',\r\n        '#339ca8',\r\n        '#cda819',\r\n        '#32a487'\r\n    ],\r\n    roma: [\r\n        '#E01F54',\r\n        '#001852',\r\n        '#f5e8c8',\r\n        '#b8d2c7',\r\n        '#c6b38e',\r\n        '#a4d8c2',\r\n        '#f3d999',\r\n        '#d3758f',\r\n        '#dcc392',\r\n        '#2e4783',\r\n        '#82b6e9',\r\n        '#ff6347',\r\n        '#a092f1',\r\n        '#0a915d',\r\n        '#eaf889',\r\n        '#6699FF',\r\n        '#ff6666',\r\n        '#3cb371',\r\n        '#d5b158',\r\n        '#38b6b6'\r\n    ],\r\n    royal: [\r\n        '#3f7ea6',\r\n        '#993366',\r\n        '#408000',\r\n        '#8c6f56',\r\n        '#a65149',\r\n        '#731f17',\r\n        '#adc2eb',\r\n        '#d9c3b0'\r\n    ],\r\n    'dark-blue': [\r\n        '#00305a',\r\n        '#004b8d',\r\n        '#0074d9',\r\n        '#4192d9',\r\n        '#7abaf2',\r\n        '#99cce6',\r\n        '#d6ebf5',\r\n        '#eeeeee'\r\n    ],\r\n    'tech-blue': [\r\n        '#4d4d4d',\r\n        '#3a5897',\r\n        '#007bb6',\r\n        '#7094db',\r\n        '#0080ff',\r\n        '#b3b3ff',\r\n        '#00bdec',\r\n        '#33ccff',\r\n        '#ccddff',\r\n        '#eeeeee'\r\n    ],\r\n    red: [\r\n        '#d8361b',\r\n        '#f16b4c',\r\n        '#f7b4a9',\r\n        '#d26666',\r\n        '#99311c',\r\n        '#c42703',\r\n        '#d07e75'\r\n    ],\r\n    'red-velvet': [\r\n        '#8b1a2d',\r\n        '#a7314b',\r\n        '#e6004c',\r\n        '#ff8066',\r\n        '#8e5c4e',\r\n        '#ff1a66',\r\n        '#d6c582',\r\n        '#f0d4af'\r\n    ],\r\n    green: [\r\n        '#408829',\r\n        '#68a54a',\r\n        '#a9cba2',\r\n        '#86b379',\r\n        '#397b29',\r\n        '#8abb6f',\r\n        '#759c6a',\r\n        '#bfd3b7'\r\n    ],\r\n    light: ['#37A2DA', '#32C5E9', '#67E0E3', '#9FE6B8', '#FFDB5C', '#ff9f7f', '#fb7293', '#E062AE', '#E690D1', '#e7bcf3', '#9d96f5', '#8378EA', '#96BFFF'],\r\n    gray: [\r\n        '#757575',\r\n        '#c7c7c7',\r\n        '#dadada',\r\n        '#8b8b8b',\r\n        '#b5b5b5',\r\n        '#e9e9e9'\r\n    ],\r\n    'dark-bold': [\r\n        '#458c6b',\r\n        '#f2da87',\r\n        '#d9a86c',\r\n        '#d94436',\r\n        '#a62424',\r\n        '#76bc9b',\r\n        '#cce6da',\r\n        '#eeeeee'\r\n    ]\r\n};\r\n\r\nfunction padding2(num) {\r\n    // on safari 9.0 it is unknown\r\n    // return num.toString().padStart(2, '0');\r\n    num = (num || '').toString();\r\n    if (num.length < 2) {\r\n        return '0' + num;\r\n    } else {\r\n        return num;\r\n    }\r\n}\r\n\r\nclass ChartOption {\r\n    constructor(moment, themeType, calcTextWidth, config) {\r\n        this.moment = moment;\r\n        if (!this.moment) {\r\n            throw new Error('moment must be set and initialized');\r\n        }\r\n\r\n        this.config = config ? JSON.parse(JSON.stringify(config)) : null;\r\n        this.calcTextWidth = calcTextWidth;\r\n        this.themeType = themeType || 'light';\r\n        this.chart = {yAxis: []};\r\n    }\r\n\r\n    setThemeName(themeType) {\r\n        this.themeType = themeType || 'light';\r\n    }\r\n\r\n    setConfig(config) {\r\n        this.config = config;\r\n    }\r\n\r\n    getHelperChartData() {\r\n        return this.chart;\r\n    }\r\n\r\n    convertData(data, i, yAxisIndex) {\r\n        const values = data[i];\r\n        if (!values || !values.length) {\r\n            return [];\r\n        }\r\n\r\n        const yAxis = this.chart.yAxis[yAxisIndex] || {max: null, min: null};\r\n        this.chart.yAxis[yAxisIndex] = yAxis;\r\n\r\n        for (let i = 0; i < values.length; i++) {\r\n            if (values[i].value[1] === null) {\r\n                continue;\r\n            }\r\n\r\n            if (yAxis.min === null || yAxis.min > values[i].value[1]) {\r\n                yAxis.min = values[i].value[1];\r\n            }\r\n            if (yAxis.max === null || yAxis.max < values[i].value[1]) {\r\n                yAxis.max = values[i].value[1];\r\n            }\r\n        }\r\n\r\n        if (this.chart.xMin === null || this.chart.xMin > values[0].value[0]) {\r\n            this.chart.xMin = values[0].value[0];\r\n        }\r\n        if (this.chart.xMax === null || this.chart.xMax < values[values.length - 1].value[0]) {\r\n            this.chart.xMax = values[values.length - 1].value[0];\r\n        }\r\n\r\n        return values;\r\n    }\r\n\r\n    getSeries(data, theme) {\r\n        this.chart.xMin = null;\r\n        this.chart.xMax = null;\r\n        let colorCount = 0;\r\n\r\n        return this.config.l.map((oneLine, i) => {\r\n            const color = oneLine.color || (THEMES[theme] ? THEMES[theme][colorCount % THEMES[theme].length] : '');\r\n            if (!oneLine.color) {\r\n                colorCount++;\r\n            }\r\n            const yAxisIndex = oneLine.commonYAxis === '' || oneLine.commonYAxis === undefined ? i : parseInt(oneLine.commonYAxis) || 0;\r\n            const cfg = {\r\n                name: oneLine.name,\r\n                xAxisIndex: 0,\r\n                yAxisIndex,\r\n                type: oneLine.chartType === 'scatterplot' ? 'scatter' : 'line',\r\n                showSymbol: oneLine.chartType === 'scatterplot' || oneLine.points,\r\n                hoverAnimation: true,\r\n                animation: false,\r\n                step: oneLine.chartType === 'steps' ? 'end' : undefined,\r\n                smooth: oneLine.chartType === 'spline',\r\n                data: this.convertData(data, i, yAxisIndex),\r\n                itemStyle: {color},\r\n                symbolSize: (oneLine.chartType === 'scatterplot' || oneLine.points) ? (oneLine.symbolSize || 3) : undefined,\r\n                symbol: 'circle',\r\n                lineStyle: {\r\n                    width:          oneLine.thickness || 1,\r\n                    shadowBlur:     oneLine.shadowsize ? oneLine.shadowsize + 1 : 0,\r\n                    shadowOffsetY:  oneLine.shadowsize ? oneLine.shadowsize + 1 : 0,\r\n                    shadowColor:    color,\r\n                    type:           oneLine.dashes ? 'dashed' : (oneLine.lineStyle || 'solid'),\r\n                }\r\n            };\r\n            if (parseFloat(oneLine.fill)) {\r\n                cfg.areaStyle = {\r\n                    color: color,\r\n                    opacity: parseFloat(oneLine.fill),\r\n                };\r\n            }\r\n\r\n            return cfg;\r\n        });\r\n    }\r\n\r\n    getXAxis() {\r\n        return [\r\n            {\r\n                type: 'time',\r\n                splitLine: {\r\n                    show: !this.config.grid_hideX,\r\n                    lineStyle: this.config.l[0].xaxe === 'off' ? {color: 'rgba(0,0,0,0)', type: 'dashed'} : this.config.grid_color ? {\r\n                        color: this.config.grid_color,\r\n                        type: 'dashed',\r\n                    } : {type: 'dashed'},\r\n                },\r\n                splitNumber: parseInt(this.config.l[0].xticks, 10) || undefined,\r\n                position: this.config.l[0].xaxe === 'top' ? 'top' : 'bottom',\r\n                min: this.chart.xMin,\r\n                max: this.chart.xMax,\r\n                axisTick: {\r\n                    alignWithLabel: true,\r\n                    lineStyle: this.config.l[0].xaxe === 'off' ?\r\n                        {color: 'rgba(0,0,0,0)'}\r\n                        :\r\n                        (this.config.x_ticks_color ? {color: this.config.x_ticks_color} : undefined),\r\n                },\r\n                axisLabel: {\r\n                    formatter: this.xFormatter.bind(this),\r\n                    color: this.config.l[0].xaxe === 'off' ? 'rgba(0,0,0,0)' : (this.config.x_labels_color || undefined),\r\n                }\r\n            }\r\n        ];\r\n    }\r\n\r\n    getYAxis(theme, series) {\r\n        return this.config.l.map((oneLine, i) => {\r\n            if (!oneLine || (oneLine.commonYAxis !== '' && oneLine.commonYAxis !== undefined)) {\r\n                return {};\r\n            }\r\n\r\n            let yMin = parseFloat(oneLine.min);\r\n            let yMax = parseFloat(oneLine.max);\r\n\r\n            const yAxis = this.chart.yAxis;\r\n            if (yAxis[i]) {\r\n                const diff = yAxis[i].max - yAxis[i].min;\r\n                if (isNaN(yMin)) {\r\n                    // auto calculate\r\n                    yMin = yAxis[i].min - diff * 0.1; // min - 10%\r\n                    if (diff > 25000) {\r\n                        yMin = Math.floor(yMin / 10000) * 10000;\r\n                    } else if (diff > 5000) {\r\n                        yMin = Math.floor(yMin / 1000) * 1000;\r\n                    } else if (diff > 200) {\r\n                        yMin = Math.floor(yMin / 100) * 100;\r\n                    } else if (diff > 30) {\r\n                        yMin = Math.floor(yMin / 10) * 10;\r\n                    } else if (diff > 10) {\r\n                        yMin = Math.floor(yMin);\r\n                    } else if (diff > 1) {\r\n                        yMin = Math.floor(yMin * 10) / 10;\r\n                    }\r\n                }\r\n                if (isNaN(yMax)) {\r\n                    // auto calculate\r\n                    yMax = yAxis[i].max + diff * 0.1; // max + 10%\r\n                    if (diff > 25000) {\r\n                        yMax = Math.ceil(yMax / 10000) * 10000;\r\n                    } else if (diff > 5000) {\r\n                        yMax = Math.ceil(yMax / 1000) * 1000;\r\n                    } else if (diff > 200) {\r\n                        yMax = Math.ceil(yMax / 100) * 100;\r\n                    } else if (diff > 30) {\r\n                        yMax = Math.ceil(yMax / 10) * 10;\r\n                    } else if (diff > 10) {\r\n                        yMax = Math.ceil(yMax);\r\n                    } else if (diff > 1) {\r\n                        yMax = Math.floor(yMax * 10) / 10;\r\n                    }\r\n                }\r\n            } else {\r\n                if (isNaN(yMin)) {\r\n                    yMin = undefined;\r\n                }\r\n                if (isNaN(yMax)) {\r\n                    yMax = undefined;\r\n                }\r\n            }\r\n\r\n            let color = oneLine.yaxe === 'off' ? 'rgba(0,0,0,0)' : (this.config.grid_color || undefined);\r\n            if (oneLine.yaxe === 'leftColor' || oneLine.yaxe === 'rightColor') {\r\n                color = series[i].itemStyle.color;\r\n            }\r\n\r\n            return {\r\n                type: 'value',\r\n                min: yMin,\r\n                max: yMax,\r\n                position: (oneLine.yaxe === 'left' || oneLine.yaxe === 'off' || oneLine.yaxe === 'leftColor') ?\r\n                    'left' :\r\n                    (oneLine.yaxe === 'right' || oneLine.yaxe === 'rightColor' ?\r\n                            'right' :\r\n                            (!i ? 'left' : 'right')\r\n                    ), // by default only first line is on the left\r\n                splitLine: !i ? { // grid has only first line\r\n                    show: !this.config.grid_hideY,\r\n                    lineStyle: {\r\n                        color: color || undefined,\r\n                        type: 'dashed',\r\n                    },\r\n                } : undefined,\r\n                splitNumber: parseInt(oneLine.yticks, 10) || undefined,\r\n                axisLabel: {\r\n                    formatter: value => this.yFormatter(value, i, true),\r\n                    color: oneLine.yaxe === 'off' || oneLine.yaxe === 'leftColor' || oneLine.yaxe === 'rightColor' ? color : (this.config.y_labels_color || undefined),\r\n                },\r\n                axisTick: {\r\n                    alignWithLabel: true,\r\n                    lineStyle: color ? {color} : (this.config.y_ticks_color ? {color: this.config.y_ticks_color} : undefined)\r\n                }\r\n            };\r\n        });\r\n    }\r\n\r\n    getMarkings(options) {\r\n        // fill markings\r\n        this.config.marks && this.config.marks.forEach(oneMark => {\r\n            const lowerLimitFloat = oneMark.lowerValue !== undefined ? oneMark.lowerValue : parseFloat(oneMark.lowerValueOrId);\r\n            const upperLimitFloat = oneMark.upperValue !== undefined ? oneMark.upperValue : parseFloat(oneMark.upperValueOrId);\r\n            const isLowerNumber   = lowerLimitFloat !== null && !isNaN(lowerLimitFloat);\r\n            const isUpperNumber   = upperLimitFloat !== null && !isNaN(upperLimitFloat);\r\n\r\n            const series = options.series[oneMark.lineId];\r\n\r\n            if (isLowerNumber && isUpperNumber) {\r\n                // area\r\n                series.markArea = series.markArea || {\r\n                    symbol: ['none', 'none'],\r\n                    itemStyle: {\r\n                        color:       oneMark.color || series.itemStyle.color,\r\n                        borderWidth: 0,\r\n                        opacity:     parseFloat(oneMark.fill),\r\n                    },\r\n                    data: []\r\n                };\r\n                series.markArea.data.push([\r\n                    {yAxis: lowerLimitFloat, name: oneMark.text || ''},\r\n                    {yAxis: upperLimitFloat},\r\n                ]);\r\n\r\n            }\r\n            if (isLowerNumber || isUpperNumber) {\r\n                for (let i = 0; i < 2; i++) {\r\n                    if (!i && !isUpperNumber) {\r\n                        continue;\r\n                    } else if (i && !isLowerNumber) {\r\n                        continue;\r\n                    }\r\n                    const limitFloat = i ? lowerLimitFloat : upperLimitFloat;\r\n                    series.markLine = series.markLine || {\r\n                        symbol: ['none', 'none'],\r\n                        data: []\r\n                    };\r\n\r\n                    series.markLine.data.push({\r\n                        yAxis: limitFloat,\r\n                        name: oneMark.text,\r\n                        lineStyle: {\r\n                            color:          oneMark.color || series.itemStyle.color,\r\n                            width:          parseFloat(oneMark.ol) || 1,\r\n                            shadowBlur:     parseFloat(oneMark.os) ? parseFloat(oneMark.os) + 1 : 0,\r\n                            shadowOffsetY:  parseFloat(oneMark.os) ? parseFloat(oneMark.os) + 1 : 0,\r\n                            shadowColor:    oneMark.color,\r\n                            type:           oneMark.lineStyle || 'solid',\r\n                        },\r\n                        label: {\r\n                            show: !!oneMark.text,\r\n                            formatter: param => param.name,\r\n                            position: oneMark.textPosition === 'r' ? 'end' : 'start',\r\n                            distance: (-1 * oneMark.textOffset) || -35,\r\n                            textStyle: {\r\n                                color: oneMark.textColor || '#FFF',\r\n                                fontStyle: 'normal',\r\n                                fontSize: oneMark.textSize || undefined,\r\n                            }\r\n                        },\r\n                    });\r\n\r\n                    if (this.config.l[oneMark.lineId]) {\r\n                        // if minimum not set\r\n                        let yMin = parseFloat(this.config.l[oneMark.lineId].min);\r\n                        if (isNaN(yMin) && this.chart.yAxis[oneMark.lineId]) {\r\n                            if (this.chart.yAxis[oneMark.lineId].min > limitFloat && limitFloat < 0) {\r\n                                options.yAxis[0].min = limitFloat;\r\n                            }\r\n                        }\r\n                        let yMax = parseFloat(this.config.l[oneMark.lineId].min);\r\n                        if (isNaN(yMax) && this.chart.yAxis[oneMark.lineId]) {\r\n                            if (this.chart.yAxis[oneMark.lineId].max < limitFloat) {\r\n                                options.yAxis[0].max = limitFloat;\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        });\r\n\r\n        return options;\r\n    }\r\n\r\n    yFormatter(val, line, withUnit, interpolated) {\r\n        if (this.config.l[line].type === 'boolean') {\r\n            return val ? 'TRUE' : 'FALSE';\r\n        }\r\n\r\n        if (val === null || val === undefined) {\r\n            return '';\r\n        }\r\n\r\n        const afterComma = this.config.l[line].afterComma;\r\n        if (afterComma !== undefined && afterComma !== null) {\r\n            val = parseFloat(val);\r\n            if (this.config.useComma) {\r\n                return val.toFixed(afterComma).replace('.', ',') + (withUnit ? this.config.l[line].unit : '');\r\n            } else {\r\n                return val.toFixed(afterComma) + (withUnit ? this.config.l[line].unit : '');\r\n            }\r\n        } else {\r\n            if (interpolated) {\r\n                val = Math.round(val * 10000) / 10000;\r\n            }\r\n\r\n            if (this.config.useComma) {\r\n                val = parseFloat(val) || 0;\r\n                return val.toString().replace('.', ',') + (withUnit ? this.config.l[line].unit : '');\r\n            } else {\r\n                return val.toString() + (withUnit ? this.config.l[line].unit : '');\r\n            }\r\n        }\r\n    }\r\n\r\n    isXLabelHasBreak() {\r\n        if (this.config.timeFormat) {\r\n            return this.config.timeFormat.replace('<br/>', '\\n').includes('\\n');\r\n        } else\r\n        if (this.chart.withSeconds) {\r\n            return false;\r\n        } else if (this.chart.withTime) {\r\n            return true;\r\n        } else {\r\n            return true;\r\n        }\r\n    }\r\n\r\n    xFormatter(value, _index) {\r\n        const date = new Date(value);\r\n        if (this.config.timeFormat) {\r\n            return this.moment(date).format(this.config.timeFormat).replace('<br/>', '\\n');\r\n        } else\r\n        if (this.chart.withSeconds) {\r\n            return padding2(date.getHours()) + ':' + padding2(date.getMinutes()) + ':' + padding2(date.getSeconds());\r\n        } else if (this.chart.withTime) {\r\n            return padding2(date.getHours()) + ':' + padding2(date.getMinutes()) + '\\n' + padding2(date.getDate()) + '.' + padding2(date.getMonth() + 1);\r\n        } else {\r\n            return padding2(date.getDate()) + '.' + padding2(date.getMonth() + 1) + '\\n' + date.getFullYear();\r\n        }\r\n    }\r\n\r\n    // result.val === null => start and end are null\r\n    // result === null => no start or no end\r\n    getInterpolatedValue(i, ts, type, hoverNoNulls) {\r\n        const data = this.option.series[i].data;\r\n        if (!data || !data[0] || data[0].value[0] > ts || data[data.length - 1].value[0] < ts) {\r\n            return null;\r\n        }\r\n\r\n        for (let k = 0; k < data.length - 1; k++) {\r\n            if (data[k].value[0] === ts) {\r\n                // Calculate\r\n                return {exact: true, val: data[k].value[1]};\r\n            } else if (data[k].value[0] < ts && ts < data[k + 1].value[0]) {\r\n                const y1 = data[k].value[1];\r\n                const y2 = data[k + 1].value[1];\r\n                if (y2 === null || y2 === undefined || y1 === null || y1 === undefined) {\r\n                    return hoverNoNulls ? null : {exact: false, val: null};\r\n                }\r\n                if (type === 'boolean') {\r\n                    return {exact: false, val: y1};\r\n                }\r\n\r\n                // interpolate\r\n                const diff = data[k + 1].value[0] - data[k].value[0];\r\n                const kk = (data[k + 1].value[0] - ts) / diff;\r\n                return {exact: false, val: (1 - kk) * (y2 - y1) + y1};\r\n            }\r\n        }\r\n        return hoverNoNulls ? null : {exact: false, val: null};\r\n    }\r\n\r\n    renderTooltip(params) {\r\n        const ts = params[0].value[0];\r\n        const date = new Date(ts);\r\n        const hoverNoNulls = this.config.hoverNoNulls === true || this.config.hoverNoNulls === 'true';\r\n\r\n        const values = this.option.series.map((line, i) => {\r\n            const p = params.find(param => param.seriesIndex === i);\r\n            let interpolated;\r\n            if (p) {\r\n                interpolated = {exact: p.data.exact !== undefined ? p.data.exact : true, val: p.value[1]};\r\n            }\r\n\r\n            interpolated = interpolated || this.getInterpolatedValue(i, ts, this.config.l[i].type, hoverNoNulls);\r\n            if (!interpolated) {\r\n                return '';\r\n            }\r\n            const val = interpolated.val === null ?\r\n                'null' :\r\n                this.yFormatter(interpolated.val, i, false, !interpolated.exact);\r\n\r\n            return `<div style=\"width: 100%; display: inline-flex; justify-content: space-around; color: ${line.itemStyle.color}\">` +\r\n                `<div style=\"display: flex;margin-right: 4px\">${line.name}:</div>` +\r\n                `<div style=\"display: flex; flex-grow: 1\"></div>` +\r\n                `<div style=\"display: flex;\">${interpolated.exact ? '' : 'i '}<b>${val}</b>${interpolated.val !== null ? this.config.l[i].unit : ''}</div>` +\r\n                `</div>`;\r\n        });\r\n\r\n        const format = this.config.timeFormat || 'dd, MM Do YYYY, h:mm:ss.SSS';\r\n        return `<b>${this.moment(date).format(format)}</b><br/>${values.filter(t => t).join('<br/>')}`;\r\n    }\r\n\r\n    getLegend(xAxisHeight) {\r\n        return !this.config.legend || this.config.legend === 'none' ? undefined : {\r\n            data:   this.config.l.map(oneLine => oneLine.name),\r\n            show:   true,\r\n            left:   this.config.legend === 'nw' || this.config.legend === 'sw' ?  this.chart.padLeft  + 1 : undefined,\r\n            right:  this.config.legend === 'ne' || this.config.legend === 'se' ?  this.chart.padRight + 1 : undefined,\r\n            top:    this.config.legend === 'nw' || this.config.legend === 'ne' ?  10 : undefined,\r\n            bottom: this.config.legend === 'sw' || this.config.legend === 'se' ?  xAxisHeight + 20 : undefined,\r\n            backgroundColor: this.config.legBg || undefined,\r\n            textStyle: {\r\n                color: this.config.legColor || (this.themeType === 'light' ? '#000' : '#FFF')\r\n            },\r\n        }\r\n    }\r\n\r\n    getTitle(xAxisHeight) {\r\n        if (!this.config.title) {\r\n            return undefined;\r\n        }\r\n        let titlePos = {};\r\n        (this.config.titlePos || 'top:35;left:65').split(';').forEach(a => {\r\n            const parts = a.split(':');\r\n            titlePos[parts[0].trim()] = parseInt(parts[1].trim(), 10);\r\n        });\r\n\r\n        return {\r\n            text: this.config.title,\r\n            textStyle: {\r\n                fontSize: this.config.titleSize ? parseInt(this.config.titleSize, 10) : 20,\r\n                color:    this.config.titleColor || (this.themeType === 'light' ? '#000' : '#FFF')\r\n            },\r\n            textVerticalAlign: titlePos.bottom      ? 'bottom' : 'top',\r\n            textAlign:         titlePos.left === 50 ? 'center' : (titlePos.right === -5 ? 'right' : 'left'),\r\n            top:               titlePos.top  === 35 ? 5        : (titlePos.top   === 50 ? '50%'   : undefined),\r\n            left:              titlePos.left === 50 ? '50%'    : (titlePos.left  === 65 ? this.chart.padLeft : undefined),\r\n            bottom:            titlePos.bottom      ? (titlePos.bottom > 0 ? titlePos.bottom + xAxisHeight - 10 : titlePos.bottom) : undefined,\r\n            right:             titlePos.right === 5 ? this.chart.padRight : undefined,\r\n        };\r\n    }\r\n\r\n    getOption(data, config) {\r\n        if (config) {\r\n            this.config = JSON.parse(JSON.stringify(config));\r\n        }\r\n\r\n        const xAxisHeight = 20;\r\n\r\n        let theme = this.config.theme;\r\n        if (!theme || theme === 'default') {\r\n            theme = this.themeType === 'light' ? 'roma' : 'dark-bold';\r\n        }\r\n\r\n        this.debug = this.config && this.config.debug;\r\n\r\n        this.debug && console.log(`[ChartView ] [${new Date().toISOString()}] ${JSON.stringify(this.config, null, 2)}`);\r\n\r\n        const series = this.getSeries(data, theme);\r\n\r\n        if (this.config.start) {\r\n            if (this.chart.xMax < this.config.end) {\r\n                this.chart.xMax = this.config.end;\r\n            }\r\n            if (this.chart.xMin > this.config.start) {\r\n                this.chart.xMin = this.config.start;\r\n            }\r\n        }\r\n\r\n        this.chart.diff        = this.chart.xMax - this.chart.xMin;\r\n        this.chart.withTime    = this.chart.diff < 3600000 * 24 * 7;\r\n        this.chart.withSeconds = this.chart.diff < 60000 * 30;\r\n\r\n        const yAxis = this.getYAxis(theme, series);\r\n        const xAxis = this.getXAxis();\r\n\r\n        const option = {\r\n            theme,\r\n            backgroundColor: 'transparent',\r\n            animation: !this.config.noAnimation && !this.config.noLoader,\r\n            grid: {\r\n                backgroundColor: this.config.bg_custom || 'transparent',\r\n                show: !!this.config.bg_custom,\r\n                left:   0,\r\n                top:    8,\r\n                right:  0,\r\n                bottom: this.isXLabelHasBreak() ? 40 : 24,\r\n            },\r\n            tooltip: this.config.hoverDetail ? {\r\n                trigger: 'axis',\r\n                formatter: params => this.renderTooltip(params),\r\n                hoverAnimation: true,\r\n                axisPointer: {\r\n                    animation: true\r\n                }\r\n            } : undefined,\r\n            xAxis,\r\n            yAxis,\r\n            /*toolbox: false && (this.config.export === true || this.config.export === 'true') ? {\r\n                left: 'right',\r\n                feature: {\r\n                    saveAsImage: {\r\n                        title: props.t('Save as image'),\r\n                        show: true,\r\n                    }\r\n                }\r\n            } : undefined,*/\r\n            /*dataZoom: [\r\n                {\r\n                    show: true,\r\n                    realtime: true,\r\n                    startValue: this.start,\r\n                    endValue: this.end,\r\n                    y: this.state.chartHeight - 50,\r\n                    dataBackground: {\r\n                        lineStyle: {\r\n                            color: '#FFFFFF'\r\n                        },\r\n                        areaStyle: {\r\n                            color: '#FFFFFFE0'\r\n                        }\r\n                    },\r\n                },\r\n                {\r\n                    show: true,\r\n                    type: 'inside',\r\n                    realtime: true,\r\n                },\r\n            ],*/\r\n            series\r\n        };\r\n\r\n        this.getMarkings(option);\r\n\r\n        // calculate padding: left and right\r\n        let padLeft  = 0;\r\n        let padRight = 0;\r\n        series.forEach((ser, i) => {\r\n            let yAxis = option.yAxis[ser.yAxisIndex];\r\n            if (!yAxis) {\r\n                // seems this axis is defined something else\r\n                const cY = this.config.l[ser.yAxisIndex] ? this.config.l[ser.yAxisIndex].commonYAxis : undefined;\r\n                if (cY !== undefined) {\r\n                    yAxis = option.yAxis[cY];\r\n                } else {\r\n                    console.log('Cannot find Y axis for line ' + i);\r\n                    return;\r\n                }\r\n            }\r\n\r\n            let minTick = this.yFormatter(yAxis.min, i, true);\r\n            let maxTick = this.yFormatter(!yAxis.min && yAxis.max === yAxis.min ? 0.8 : yAxis.max, i, true);\r\n\r\n            const position = yAxis.position;\r\n            if (position === 'off' || (yAxis.axisLabel && yAxis.axisLabel.color === 'rgba(0,0,0,0)')) {\r\n                return;\r\n            }\r\n            let wMin = this.calcTextWidth(minTick) + 4;\r\n            let wMax = this.calcTextWidth(maxTick) + 4;\r\n            if (position === 'left' || position === 'leftColor') {\r\n                if (wMin > padLeft) {\r\n                    padLeft = wMin;\r\n                }\r\n                if (wMax > padLeft) {\r\n                    padLeft = wMax;\r\n                }\r\n            } else {\r\n                if (wMin > padRight) {\r\n                    padRight = wMin;\r\n                }\r\n                if (wMax > padRight) {\r\n                    padRight = wMax;\r\n                }\r\n            }\r\n        });\r\n        option.grid.left = padLeft + 10;\r\n        option.grid.right = padRight + 10 + (this.config.export === true || this.config.export === 'true' ? 20 : 0);\r\n        this.chart.padLeft = option.grid.left;\r\n        this.chart.padRight = option.grid.right;\r\n\r\n        // 'nw': 'Top, left',\r\n        // 'ne': 'Top, right',\r\n        // 'sw': 'Bottom, left',\r\n        // 'se': 'Bottom, right',\r\n        option.legend = this.getLegend(xAxisHeight);\r\n        option.title  = this.getTitle(xAxisHeight);\r\n\r\n        if (!this.config.grid_color) {\r\n            option.yAxis.forEach(axis => axis.splitLine && delete axis.splitLine.lineStyle);\r\n            option.xAxis.forEach(axis => axis.splitLine && delete axis.splitLine.lineStyle);\r\n        }\r\n\r\n        this.option = option;\r\n        return this.option;\r\n    }\r\n}\r\n\r\nmodule.exports = ChartOption;","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport withWidth from '@material-ui/core/withWidth';\r\nimport {withStyles} from '@material-ui/core/styles';\r\n\r\nimport LinearProgress from '@material-ui/core/LinearProgress';\r\nimport Fab from '@material-ui/core/Fab';\r\n\r\nimport {FaRedoAlt as IconReset}  from 'react-icons/fa'\r\nimport {FaDownload as IconExport}  from 'react-icons/fa'\r\n\r\nimport moment from 'moment';\r\nimport 'moment/locale/en-gb';\r\nimport 'moment/locale/es';\r\nimport 'moment/locale/fr';\r\nimport 'moment/locale/pl';\r\nimport 'moment/locale/pt';\r\nimport 'moment/locale/it';\r\nimport 'moment/locale/nl';\r\nimport 'moment/locale/ru';\r\nimport 'moment/locale/zh-cn';\r\nimport 'moment/locale/de';\r\n\r\nimport I18n from '@iobroker/adapter-react/i18n';\r\n\r\nimport ReactEchartsCore from 'echarts-for-react/lib/core';\r\nimport echarts from 'echarts/lib/echarts';\r\nimport 'echarts/lib/chart/line';\r\nimport 'echarts/lib/chart/scatter';\r\nimport 'echarts/lib/component/tooltip';\r\nimport 'echarts/lib/component/grid';\r\nimport 'echarts/lib/component/markLine';\r\nimport 'echarts/lib/component/markArea';\r\n\r\nimport ChartOption from './ChartOption';\r\n\r\n// Themes\r\nimport 'echarts/theme/azul';\r\nimport 'echarts/theme/bee-inspired';\r\nimport 'echarts/theme/blue';\r\nimport 'echarts/theme/infographic';\r\nimport 'echarts/theme/vintage';\r\nimport 'echarts/theme/dark';\r\nimport 'echarts/theme/macarons';\r\nimport 'echarts/theme/shine';\r\nimport 'echarts/theme/roma';\r\nimport 'echarts/theme/royal';\r\nimport 'echarts/theme/dark-blue';\r\nimport 'echarts/theme/tech-blue';\r\nimport 'echarts/theme/red';\r\nimport 'echarts/theme/red-velvet';\r\nimport 'echarts/theme/green';\r\nimport 'echarts/theme/gray';\r\nimport 'echarts/theme/dark-bold';\r\n\r\nimport 'echarts/lib/component/toolbox';\r\nimport 'echarts/lib/component/title';\r\nimport 'echarts/lib/component/legend';\r\n\r\nimport 'echarts/lib/component/dataZoom';\r\nimport 'echarts/lib/component/timeline';\r\nimport 'zrender/lib/svg/svg';\r\n\r\nconst styles = theme => ({\r\n    chart: {\r\n        maxHeight: '100%',\r\n        maxWidth: '100%',\r\n        width: '100%',\r\n        height: '100%',\r\n        overflow: 'hidden',\r\n        position: 'relative',\r\n    },\r\n    exportButton: {\r\n        position: 'absolute',\r\n        top: 40,\r\n        right: 5,\r\n        width: 20,\r\n        height: 20,\r\n        zIndex: 2,\r\n        opacity: 0.7,\r\n        cursor: 'pointer'\r\n        //background: '#00000000',\r\n    },\r\n    resetButton: {\r\n        position: 'absolute',\r\n        top: 10,\r\n        right: 25,\r\n        zIndex: 2,\r\n        opacity: 0.7\r\n        //background: '#00000000',\r\n    },\r\n    resetButtonIcon: {\r\n        paddingTop: 6,\r\n    },\r\n});\r\n\r\nlet canvasCalcTextWidth = null;\r\nfunction calcTextWidth(text, fontSize, fontFamily) {\r\n    // canvas for better performance\r\n    const canvas = canvasCalcTextWidth || (canvasCalcTextWidth = document.createElement('canvas'));\r\n    const context = canvas.getContext('2d');\r\n    context.font = `${fontSize || 12}px ${fontFamily || 'Microsoft YaHei'}`;\r\n    const metrics = context.measureText(text);\r\n    return Math.ceil(metrics.width);\r\n}\r\n\r\nclass ChartView extends React.Component {\r\n    constructor(props) {\r\n        super(props);\r\n\r\n        this.state = {\r\n            chartHeight: null,\r\n            chartWidth: null,\r\n        };\r\n\r\n        this.echartsReact = React.createRef();\r\n        // this.rangeRef     = React.createRef();\r\n\r\n        this.divRef = React.createRef();\r\n        this.divResetButton = React.createRef();\r\n\r\n        moment.locale(I18n.getLanguage());\r\n\r\n        this.lastIds = (this.props.config && this.props.config.l && this.props.config.l.map(item => item.id)) || [];\r\n        this.lastIds.sort();\r\n\r\n        this.chartOption = new ChartOption(moment, this.props.themeType, calcTextWidth);\r\n    }\r\n\r\n    componentDidMount() {\r\n        window.addEventListener('resize', this.onResize)\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        window.removeEventListener('resize', this.onResize);\r\n    }\r\n\r\n    updateProperties = props => {\r\n        this.updatePropertiesTimeout = null;\r\n        if (this.echartsReact && typeof this.echartsReact.getEchartsInstance === 'function') {\r\n            const chartInstance = this.echartsReact.getEchartsInstance();\r\n            const lastIds = (props.config && props.config.l && props.config.l.map(item => item.id)) || [];\r\n            lastIds.sort();\r\n            const changed = JSON.stringify(lastIds) !== JSON.stringify(this.lastIds);\r\n            // If list of IDs changed => clear all settings\r\n            if (changed)  {\r\n                this.lastIds = lastIds;\r\n                chartInstance.clear();\r\n            }\r\n\r\n            this.option = this.chartOption.getOption(props.data, props.config);\r\n            this.debug && console.log(`[ChartView ] [${new Date().toISOString()}] updateProperties: {min: ${this.option.xAxis[0].min}, ${this.option.xAxis[0].max}}`);\r\n            try {\r\n                chartInstance.setOption(this.option, changed);\r\n            } catch (e) {\r\n                console.error('Cannot apply options: ' + JSON.stringify(this.option));\r\n            }\r\n        }\r\n    };\r\n\r\n    UNSAFE_componentWillReceiveProps(props) {\r\n        if (props.data !== this.state.data) {\r\n            this.updatePropertiesTimeout && clearTimeout(this.updatePropertiesTimeout);\r\n            this.updatePropertiesTimeout = setTimeout(this.updateProperties, 100, props);\r\n        } else {\r\n            return null;\r\n        }\r\n    }\r\n\r\n    onResize = () => {\r\n        this.timerResize && clearTimeout(this.timerResize);\r\n\r\n        this.timerResize = setTimeout(() => {\r\n            this.timerResize = null;\r\n            this.componentDidUpdate();\r\n        });\r\n    };\r\n\r\n    /*onChange = (id, state) => {\r\n        if (id === this.props.obj._id &&\r\n            state &&\r\n            this.rangeValues &&\r\n            (!this.rangeValues.length || this.rangeValues[this.rangeValues.length - 1].ts < state.ts)) {\r\n\r\n            this.chartValues && this.chartValues.push({val: state.val, ts: state.ts});\r\n            this.rangeValues.push({val: state.val, ts: state.ts});\r\n\r\n            // update only if end is near to now\r\n            if (state.ts >= this.chart.min && state.ts <= this.chart.xMax + 300000) {\r\n                this.updateChart();\r\n            }\r\n        }\r\n    };*/\r\n\r\n    /*updateChart(start, end, withReadData, cb) {\r\n        if (start) {\r\n            this.start = start;\r\n        }\r\n        if (end) {\r\n            this.end = end;\r\n        }\r\n        start = start || this.start;\r\n        end   = end   || this.end;\r\n\r\n        this.readTimeout && clearTimeout(this.readTimeout);\r\n\r\n        this.readTimeout = setTimeout(() => {\r\n            this.readTimeout = null;\r\n\r\n            const diff = this.chart.xMax - this.chart.xMin;\r\n            if (diff !== this.chart.diff) {\r\n                this.chart.diff        = diff;\r\n                this.chart.withTime    = this.chart.diff < 3600000 * 24 * 7;\r\n                this.chart.withSeconds = this.chart.diff < 60000 * 30;\r\n            }\r\n\r\n            if (withReadData) {\r\n                this.readHistory(start, end)\r\n                    .then(values => {\r\n                        typeof this.echartsReact.getEchartsInstance === 'function' && this.echartsReact.getEchartsInstance().setOption({\r\n                            series: [{data: this.convertData(values)}],\r\n                            xAxis: {\r\n                                min: this.chart.xMin,\r\n                                max: this.chart.xMax,\r\n                            }\r\n                        }, true);\r\n                        cb && cb();\r\n                    });\r\n            } else {\r\n                typeof this.echartsReact.getEchartsInstance === 'function' && this.echartsReact.getEchartsInstance().setOption({\r\n                    series: [{data: this.convertData()}],\r\n                    xAxis: {\r\n                        min: this.chart.xMin,\r\n                        max: this.chart.xMax,\r\n                    }\r\n                }, true);\r\n                cb && cb();\r\n            }\r\n        }, 400);\r\n    }*/\r\n\r\n    setNewRange(updateChart) {\r\n        const chart = this.chartOption.getHelperChartData();\r\n        chart.diff        = chart.xMax - chart.xMin;\r\n        chart.withTime    = chart.diff < 3600000 * 24 * 7;\r\n        chart.withSeconds = chart.diff < 60000 * 30;\r\n\r\n        console.log(`[ChartView ] [${new Date().toISOString()}] setNewRange: ${!!updateChart}, {min: ${chart.xMin}, max: ${chart.xMax}}`);\r\n        if (updateChart) {\r\n            this.updateDataTimer && clearTimeout(this.updateDataTimer);\r\n            this.updateDataTimer = null;\r\n            this.props.onRangeChange && this.props.onRangeChange({start: chart.xMin, end: chart.xMax});\r\n        } else {\r\n            console.log(`[ChartView ] [${new Date().toISOString()}] setOption in setNewRange`);\r\n            this.option.xAxis[0].min = chart.xMin;\r\n            this.option.xAxis[0].max = chart.xMax;\r\n\r\n            try {\r\n                this.echartsReact && typeof this.echartsReact.getEchartsInstance === 'function' &&\r\n                this.echartsReact.getEchartsInstance().setOption({\r\n                    xAxis: {\r\n                        min: chart.xMin,\r\n                        max: chart.xMax,\r\n                    }\r\n                });\r\n            } catch (e) {\r\n                console.error('Cannot apply options 1: ' + JSON.stringify(this.option));\r\n            }\r\n        }\r\n    }\r\n\r\n    onMouseMove = e => {\r\n        if (this.mouseDown) {\r\n            if (this.divResetButton.current && this.divResetButton.current.style.display !== 'block') {\r\n                 this.divResetButton.current.style.display = 'block';\r\n            }\r\n            const chart = this.chartOption.getHelperChartData();\r\n            const moved = chart.lastX - (e.offsetX - chart.padLeft);\r\n            chart.lastX = e.offsetX - chart.padLeft;\r\n            const diff = chart.xMax - chart.xMin;\r\n            const width = this.state.chartWidth - chart.padRight - chart.padLeft;\r\n\r\n            const shift = Math.round(moved * diff / width);\r\n            chart.xMin += shift;\r\n            chart.xMax += shift;\r\n            this.setNewRange();\r\n        }\r\n    };\r\n\r\n    onMouseDown = e => {\r\n        this.mouseDown = true;\r\n        const chart = this.chartOption.getHelperChartData();\r\n        chart.lastX = e.offsetX;\r\n        if (this.zr && !this.zr._mousemove) {\r\n            this.zr._mousemove = true;\r\n            this.zr.on('mousemove', this.onMouseMove);\r\n        }\r\n        const config = this.props.config;\r\n        if (config.live && this.props.onRangeChange) {\r\n            console.log('Stop update');\r\n            this.props.onRangeChange({stopLive: true});\r\n        }\r\n    };\r\n\r\n    onMouseUp = () => {\r\n        this.mouseDown = false;\r\n        this.setNewRange(true);\r\n        if (this.zr && this.zr._mousemove) {\r\n            this.zr._mousemove = false;\r\n            this.zr.off('mousemove', this.onMouseMove);\r\n        }\r\n    };\r\n\r\n    onMouseWheel = e => {\r\n        const chart = this.chartOption.getHelperChartData();\r\n        let diff = chart.xMax - chart.xMin;\r\n        const width = this.state.chartWidth - chart.padRight - chart.padLeft;\r\n        const x = e.offsetX - chart.padLeft;\r\n        const pos = x / width;\r\n\r\n        const oldDiff = diff;\r\n        const amount = e.wheelDelta > 0 ? 1.1 : 0.9;\r\n        diff = diff * amount;\r\n        const move = oldDiff - diff;\r\n        chart.xMax += move * (1 - pos);\r\n        chart.xMin -= move * pos;\r\n\r\n        this.setNewRange();\r\n        this.updateDataTimer && clearTimeout(this.updateDataTimer);\r\n        this.updateDataTimer = setTimeout(() => this.setNewRange(true), 1000);\r\n    };\r\n\r\n    onTouchStart = e => {\r\n        e.preventDefault();\r\n        this.mouseDown = true;\r\n        const touches = e.touches || e.originalEvent.touches;\r\n        if (touches) {\r\n            const chart = this.chartOption.getHelperChartData();\r\n            chart.lastX = touches[touches.length - 1].pageX;\r\n            if (touches.length > 1) {\r\n                chart.lastWidth = Math.abs(touches[0].pageX - touches[1].pageX);\r\n            } else {\r\n                chart.lastWidth = null;\r\n            }\r\n        }\r\n    };\r\n\r\n    onTouchEnd = e => {\r\n        e.preventDefault();\r\n        this.mouseDown = false;\r\n        this.setNewRange(true);\r\n    };\r\n\r\n    onTouchMove = e => {\r\n        e.preventDefault();\r\n        const touches = e.touches || e.originalEvent.touches;\r\n        if (!touches) {\r\n            return;\r\n        }\r\n        const chart = this.chartOption.getHelperChartData();\r\n        const pageX = touches[touches.length - 1].pageX - chart.padLeft;\r\n        if (this.mouseDown) {\r\n            if (touches.length > 1) {\r\n                // zoom\r\n                const fingerWidth = Math.abs(touches[0].pageX - touches[1].pageX);\r\n                if (chart.lastWidth !== null && fingerWidth !== chart.lastWidth) {\r\n                    let diff = chart.xMax - chart.xMin;\r\n                    const chartWidth = this.state.chartWidth - chart.padRight - chart.padLeft;\r\n\r\n                    const amount     = fingerWidth > chart.lastWidth ? 1.1 : 0.9;\r\n                    const positionX  = touches[0].pageX > touches[1].pageX ?\r\n                        touches[1].pageX - chart.padLeft + fingerWidth / 2 :\r\n                        touches[0].pageX - chart.padLeft + fingerWidth / 2;\r\n\r\n                    const pos = positionX / chartWidth;\r\n\r\n                    const oldDiff = diff;\r\n                    diff = diff * amount;\r\n                    const move = oldDiff - diff;\r\n\r\n                    chart.xMax += move * (1 - pos);\r\n                    chart.xMin -= move * pos;\r\n\r\n                    this.setNewRange();\r\n                }\r\n                chart.lastWidth = fingerWidth;\r\n            } else {\r\n                // swipe\r\n                const moved = chart.lastX - pageX;\r\n                const diff  = chart.xMax - chart.xMin;\r\n                const chartWidth = this.state.chartWidth - chart.padRight - chart.padLeft;\r\n\r\n                const shift = Math.round(moved * diff / chartWidth);\r\n                chart.xMin += shift;\r\n                chart.xMax += shift;\r\n\r\n                this.setNewRange();\r\n            }\r\n        }\r\n        chart.lastX = pageX;\r\n    };\r\n\r\n    installEventHandlers() {\r\n        this.zr = this.echartsReact && this.echartsReact.getEchartsInstance && this.echartsReact.getEchartsInstance().getZr();\r\n\r\n        if (this.zr && this.props.config.zoom && !this.zr._iobInstalled) {\r\n            this.zr._iobInstalled = true;\r\n\r\n            this.zr.on('mousedown', this.onMouseDown);\r\n\r\n            this.zr.on('mouseup', this.onMouseUp);\r\n\r\n            this.zr.on('mousewheel', this.onMouseWheel);\r\n\r\n            this.zr.on('touchstart', this.onTouchStart);\r\n\r\n            this.zr.on('touchend', this.onTouchEnd);\r\n\r\n            this.zr.on('touchmove', this.onTouchMove);\r\n        } else if (this.zr && !this.props.config.zoom && this.zr._iobInstalled) {\r\n            this.zr._iobInstalled = false;\r\n            this.zr.off('mousedown', this.onMouseDown);\r\n            this.zr.off('mouseup', this.onMouseUp);\r\n            this.zr.off('mousewheel', this.onMouseWheel);\r\n            if (this.zr && this.zr._mousemove) {\r\n                this.zr._mousemove = false;\r\n                this.zr.off('mousemove', this.onMouseMove);\r\n            }\r\n            this.zr.off('touchstart', this.onTouchStart);\r\n            this.zr.off('touchend', this.onTouchEnd);\r\n            this.zr.off('touchmove', this.onTouchMove);\r\n        }\r\n    }\r\n\r\n    renderChart() {\r\n        if (this.props.data) {\r\n            this.option = this.option || this.chartOption.getOption(this.props.data, this.props.config);\r\n\r\n            this.debug && console.log(`[ChartView ] [${new Date().toISOString()}] render chart`);\r\n\r\n            return <ReactEchartsCore\r\n                ref={e => this.echartsReact = e}\r\n                echarts={ echarts }\r\n                option={ this.option }\r\n                notMerge={ true }\r\n                lazyUpdate={ true }\r\n                theme={ this.option.theme }\r\n                style={{ height: this.state.chartHeight + 'px', width: '100%' }}\r\n                opts={{ renderer: 'svg' }}\r\n                onEvents={ {\r\n                    /*datazoom: e => {\r\n                        const {startValue, endValue} = e.batch[0];\r\n                        this.updateChart(startValue, endValue, true);\r\n                    },*/\r\n                    rendered: e => {\r\n                        this.props.config.zoom && this.installEventHandlers();\r\n                    }\r\n                }}\r\n            />;\r\n        } else {\r\n            return <LinearProgress/>;\r\n        }\r\n    }\r\n\r\n    componentDidUpdate() {\r\n        if (this.divRef.current) {\r\n            const borderWidth   = this.props.config.noBorder !== 'noborder' ? parseFloat(this.props.config.border_width) || 0 : 0;\r\n            const borderPadding = parseFloat(this.props.config.border_padding) || 0;\r\n            const chartHeight = this.divRef.current.offsetHeight - (borderWidth + borderPadding) * 2;\r\n            if (this.state.chartHeight !== chartHeight) {\r\n                const chartWidth  = this.divRef.current.offsetWidth - (borderWidth + borderPadding) * 2;\r\n                setTimeout(() => this.setState({chartHeight, chartWidth}), 10);\r\n            }\r\n        }\r\n    }\r\n\r\n    renderResetButton() {\r\n        return <Fab\r\n            ref={ this.divResetButton }\r\n            size=\"small\"\r\n            color=\"default\"\r\n            style={{display: 'none'}}\r\n            className={this.props.classes.resetButton}\r\n            title={I18n.t('Reset pan and zoom')}\r\n            onClick={() => {\r\n                if (this.divResetButton.current) {\r\n                    this.divResetButton.current.style.display = 'none';\r\n                }\r\n                this.props.onRangeChange && this.props.onRangeChange();\r\n            }}\r\n        >\r\n            <IconReset className={this.props.classes.resetButtonIcon}/>\r\n        </Fab>;\r\n    }\r\n\r\n    renderExportButton() {\r\n        if (this.props.config.export) {\r\n            return <IconExport\r\n                color={this.props.config.exportColor || 'default'}\r\n                className={this.props.classes.exportButton}\r\n                title={I18n.t('Save chart as svg')}\r\n                onClick={() => {\r\n                    if (this.echartsReact && typeof this.echartsReact.getEchartsInstance === 'function') {\r\n                        const chartInstance = this.echartsReact.getEchartsInstance();\r\n                        const base64 = chartInstance.getDataURL({\r\n                            pixelRatio: 2, // only for png\r\n                            backgroundColor: this.props.config.window_bg || (this.props.themeType === 'dark' ? '#000' : '#FFF'),\r\n                        });\r\n\r\n                        const downloadLink = document.createElement('a');\r\n                        document.body.appendChild(downloadLink);\r\n\r\n                        downloadLink.href = base64;\r\n                        downloadLink.target = '_self';\r\n                        let name = '';\r\n                        if (this.props.config.l.length === 1) {\r\n                            name = this.props.config.l[0].name;\r\n                        } else {\r\n                            name = 'chart';\r\n                        }\r\n                        const option = this.option;\r\n                        const date = new Date(option.xAxis[0].max || option.series[0].data[option.series[0].data.length - 1].value[0]);\r\n                        try {\r\n                            downloadLink.download =\r\n                                `${date.getFullYear()}_${(date.getMonth() + 1).toString().padStart(2, '0')}_${date.getDate().toString().padStart(2, '0')}` +\r\n                                `_${date.getHours().toString().padStart(2, '0')}_${date.getMinutes().toString().padStart(2, '0')}_${name}.svg`;\r\n                            downloadLink.click();\r\n                        } catch (e) {\r\n                            console.error('Cannot access download: ' + e);\r\n                            window.alert(I18n.t('Unfortunately your browser does not support this feature'));\r\n                        }\r\n                    }\r\n                }}\r\n            />\r\n        } else {\r\n            return null;\r\n        }\r\n    }\r\n\r\n    render() {\r\n        if (!this.divRef.current) {\r\n            setTimeout(() => this.forceUpdate(), 10);\r\n        }\r\n\r\n        const borderWidth   = this.props.config.noBorder !== 'noborder' ? parseFloat(this.props.config.border_width) || 0 : 0;\r\n        const borderPadding = parseFloat(this.props.config.border_padding) || 0;\r\n\r\n        return <div\r\n            ref={ this.divRef }\r\n            className={ this.props.classes.chart }\r\n            style={{\r\n                borderWidth,\r\n                width:          borderWidth || borderPadding ? 'calc(100% - ' + ((borderWidth + borderPadding) * 2 + 1) + 'px' : undefined,\r\n                height:         borderWidth || borderPadding ? 'calc(100% - ' + (borderWidth + borderPadding) * 2 + 'px' : undefined,\r\n                background:     this.props.config.window_bg || undefined,\r\n                borderColor:    this.props.config.noBorder !== 'noborder' ? this.props.config.border_color || undefined : undefined,\r\n                borderStyle:    this.props.config.noBorder !== 'noborder' && borderWidth ? this.props.config.border_style || 'solid' : 'hidden',\r\n                padding:        borderPadding || 0,\r\n            }}>\r\n            { this.renderExportButton() }\r\n            { this.renderResetButton() }\r\n            { this.state.chartHeight !== null ? this.renderChart() : null }\r\n        </div>;\r\n    }\r\n}\r\n\r\nChartView.propTypes = {\r\n    t: PropTypes.func,\r\n    lang: PropTypes.string,\r\n    config: PropTypes.object,\r\n    themeType: PropTypes.string,\r\n    data: PropTypes.array,\r\n    noAnimation: PropTypes.bool,\r\n    onRangeChange: PropTypes.func,\r\n};\r\n\r\nexport default withWidth()(withStyles(styles)(ChartView));","import React, {Component} from 'react';\r\nimport {withStyles} from '@material-ui/core/styles';\r\nimport { withTheme } from '@material-ui/core/styles';\r\nimport withWidth from '@material-ui/core/withWidth';\r\nimport { MuiThemeProvider } from '@material-ui/core/styles';\r\nimport MD5 from \"crypto-js/md5\";\r\n\r\nimport LinearProgress from '@material-ui/core/LinearProgress';\r\n\r\nimport Utils from '@iobroker/adapter-react/Components/Utils';\r\nimport Loader from '@iobroker/adapter-react/Components/Loader'\r\nimport I18n from '@iobroker/adapter-react/i18n';\r\nimport Connection, {PROGRESS} from '@iobroker/adapter-react/Connection';\r\nimport DialogError from '@iobroker/adapter-react/Dialogs/Error';\r\nimport theme from '@iobroker/adapter-react/Theme';\r\n\r\nimport '@iobroker/adapter-react/index.css';\r\n\r\nimport ChartModel from './Components/ChartModel';\r\nimport ChartView from './Components/ChartView';\r\n\r\nconst styles = theme => ({\r\n    root: {\r\n        width: '100%',\r\n        height: '100%',\r\n        position: 'relative',\r\n    },\r\n    progress: {\r\n        position: 'absolute',\r\n        top: 0,\r\n        left: 0,\r\n        right: 0,\r\n    }\r\n});\r\n\r\nclass App extends Component {\r\n    constructor(props) {\r\n        super(props);\r\n\r\n        const themeInstance = this.createTheme();\r\n\r\n        const query     = Utils.parseQuery(window.location.search);\r\n        const queryHash = Utils.parseQuery((window.location.hash || '').replace(/^#/,''));\r\n\r\n        this.state = {\r\n            connected:  false,\r\n            seriesData: null,\r\n            noLoader:   query.noLoader || queryHash.noLoader || false,\r\n            theme:      themeInstance,\r\n            themeName:  this.getThemeName(themeInstance),\r\n            themeType:  this.getThemeType(themeInstance),\r\n            noBackground: query.noBG || queryHash.noBG || false,\r\n        };\r\n\r\n        this.inEdit = query.edit     === '1' || query.edit     === 1 || query.edit     === true || query.edit === 'true' ||\r\n            queryHash.edit === '1' || queryHash.edit === 1 || queryHash.edit === true || queryHash.edit === 'true';\r\n\r\n        this.divRef      = React.createRef();\r\n        this.progressRef = React.createRef();\r\n\r\n        // init translations\r\n        const translations = {\r\n            'en': require('@iobroker/adapter-react/i18n/en'),\r\n            'de': require('@iobroker/adapter-react/i18n/de'),\r\n            'ru': require('@iobroker/adapter-react/i18n/ru'),\r\n            'pt': require('@iobroker/adapter-react/i18n/pt'),\r\n            'nl': require('@iobroker/adapter-react/i18n/nl'),\r\n            'fr': require('@iobroker/adapter-react/i18n/fr'),\r\n            'it': require('@iobroker/adapter-react/i18n/it'),\r\n            'es': require('@iobroker/adapter-react/i18n/es'),\r\n            'pl': require('@iobroker/adapter-react/i18n/pl'),\r\n            'zh-cn': require('@iobroker/adapter-react/i18n/zh-cn'),\r\n        };\r\n\r\n        const ownTranslations = {\r\n            'en': require('./i18n/en'),\r\n            'de': require('./i18n/de'),\r\n            'ru': require('./i18n/ru'),\r\n            'pt': require('./i18n/pt'),\r\n            'nl': require('./i18n/nl'),\r\n            'fr': require('./i18n/fr'),\r\n            'it': require('./i18n/it'),\r\n            'es': require('./i18n/es'),\r\n            'pl': require('./i18n/pl'),\r\n            'zh-cn': require('./i18n/zh-cn'),\r\n        };\r\n\r\n        // merge together\r\n        Object.keys(translations).forEach(lang => translations[lang] = Object.assign(translations[lang], ownTranslations[lang]));\r\n\r\n        I18n.setTranslations(translations);\r\n\r\n        try {\r\n            this.isIFrame = window.self !== window.top;\r\n        } catch (e) {\r\n            this.isIFrame = true;\r\n        }\r\n\r\n        this.socket = new Connection({\r\n            name: window.adapterName,\r\n            onProgress: progress => {\r\n                if (progress === PROGRESS.CONNECTING) {\r\n                    this.setState({connected: false});\r\n                } else if (progress === PROGRESS.READY) {\r\n                    this.setState({connected: true});\r\n                } else {\r\n                    this.setState({connected: true});\r\n                }\r\n            },\r\n            onReady: (objects, scripts) => {\r\n                I18n.setLanguage(this.socket.systemLang);\r\n\r\n                this.socket.getSystemConfig()\r\n                    .then(systemConfig => {\r\n                        this.systemLang   = systemConfig?.common?.language || 'en';\r\n                        this.isFloatComma = systemConfig?.common?.isFloatComma || false;\r\n                        if (this.inEdit) {\r\n                            window.addEventListener('message', this.onReceiveMessage);\r\n                            if (window.self !== window.parent) {\r\n                                try {\r\n                                    window.parent.postMessage('chartReady');\r\n                                } catch (e) {\r\n                                    console.warn('Cannot send ready event to parent window');\r\n                                }\r\n                            }\r\n                        } else {\r\n                            this.createChartData();\r\n                        }\r\n                    });\r\n            },\r\n            onError: err => {\r\n                console.error(err);\r\n                this.showError(err);\r\n            }\r\n        });\r\n    }\r\n\r\n    createChartData(config) {\r\n        this.chartData = new ChartModel(this.socket, config);\r\n        this.chartData.onError(err => this.showError(I18n.t(err)));\r\n        this.chartData.onReading(reading => this.showProgress(reading));\r\n        this.chartData.onUpdate(seriesData => this.setState({seriesData}, () => this.showProgress(false)));\r\n    }\r\n\r\n    showProgress(isShow) {\r\n        if (this.progressRef.current) {\r\n            this.progressRef.current.style.display = isShow ? 'block' : 'none';\r\n        }\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        this.inEdit && window.removeEventListener('message', this.onReceiveMessage, false);\r\n        this.chartData && this.chartData.destroy();\r\n    }\r\n\r\n    onReceiveMessage = message => {\r\n        if (message && message.data !== 'chartReady') {\r\n            try {\r\n                const config = JSON.parse(message.data);\r\n                if (!this.chartData) {\r\n                    this.createChartData(config);\r\n                } else {\r\n                    this.chartData.setConfig(config);\r\n                }\r\n            } catch (e) {\r\n                return console.log('Cannot parse ' + message.data);\r\n            }\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Get a theme\r\n     * @param {string} name Theme name\r\n     * @returns {Theme}\r\n     */\r\n    createTheme(name = '') {\r\n        return theme(Utils.getThemeName(name));\r\n    }\r\n\r\n    /**\r\n     * Get the theme name\r\n     * @param {Theme} theme Theme\r\n     * @returns {string} Theme name\r\n     */\r\n    getThemeName(theme) {\r\n        return theme.name;\r\n    }\r\n\r\n    /**\r\n     * Get the theme type\r\n     * @param {Theme} theme Theme\r\n     * @returns {string} Theme type\r\n     */\r\n    getThemeType(theme) {\r\n        return theme.palette.type;\r\n    }\r\n\r\n    showError(text) {\r\n        this.setState({errorText: text});\r\n    }\r\n\r\n    renderError() {\r\n        if (!this.state.errorText) {\r\n            return null;\r\n        } else {\r\n            return <DialogError classes={{}} text={this.state.errorText} onClose={() => this.setState({errorText: ''})}/>;\r\n        }\r\n    }\r\n\r\n    render() {\r\n        if (!this.state.connected || !this.state.seriesData) {\r\n            if (this.state.noLoader) {\r\n                return null;\r\n            } else {\r\n                return <MuiThemeProvider theme={this.state.theme}>\r\n                    <Loader theme={this.state.themeType}/>\r\n                </MuiThemeProvider>;\r\n            }\r\n        }\r\n\r\n        const config = this.chartData.getConfig();\r\n        // get IDs hash\r\n        const hash = MD5(JSON.stringify(((config && config.l && config.l.map(item => item.id)) || []).sort())).toString();\r\n\r\n        if (this.state.seriesData && config.debug) {\r\n            console.log('seriesData: ' + JSON.stringify(this.state.seriesData));\r\n        }\r\n\r\n        return <MuiThemeProvider theme={this.state.theme}>\r\n            <div ref={this.divRef}\r\n                 className={this.props.classes.root}\r\n                 style={{\r\n                     width: config.width,\r\n                     height: config.height,\r\n                     background: this.state.noBackground ? undefined : this.state.theme.palette.background.default,\r\n                     color: this.state.theme.palette.text.primary\r\n                 }}>\r\n                <LinearProgress ref={this.progressRef} style={{display: 'block'}} className={this.props.classes.progress}/>\r\n                <ChartView\r\n                    key={hash}\r\n                    socket={this.socket}\r\n                    t={I18n.t}\r\n                    noAnimation={this.state.noLoader}\r\n                    data={this.state.seriesData}\r\n                    config={config}\r\n                    lang={I18n.getLanguage()}\r\n                    themeType={this.state.themeType}\r\n                    onRangeChange={options => this.chartData.setNewRange(options)}\r\n                />\r\n                {this.renderError()}\r\n            </div>\r\n        </MuiThemeProvider>;\r\n    }\r\n}\r\n\r\nexport default withWidth()(withStyles(styles)(withTheme(App)));\r\n","// This optional code is used to register a service worker.\r\n// register() is not called by default.\r\n\r\n// This lets the app load faster on subsequent visits in production, and gives\r\n// it offline capabilities. However, it also means that developers (and users)\r\n// will only see deployed updates on subsequent visits to a page, after all the\r\n// existing tabs open on the page have been closed, since previously cached\r\n// resources are updated in the background.\r\n\r\n// To learn more about the benefits of this model and instructions on how to\r\n// opt-in, read http://bit.ly/CRA-PWA.\r\n\r\nconst isLocalhost = Boolean(\r\n  window.location.hostname === 'localhost' ||\r\n    // [::1] is the IPv6 localhost address.\r\n    window.location.hostname === '[::1]' ||\r\n    // 127.0.0.1/8 is considered localhost for IPv4.\r\n    window.location.hostname.match(\r\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\r\n    )\r\n);\r\n\r\nexport function register(config) {\r\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\r\n    // The URL constructor is available in all browsers that support SW.\r\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location);\r\n    if (publicUrl.origin !== window.location.origin) {\r\n      // Our service worker won't work if PUBLIC_URL is on a different origin\r\n      // from what our page is served on. This might happen if a CDN is used to\r\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\r\n      return;\r\n    }\r\n\r\n    window.addEventListener('load', () => {\r\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\r\n\r\n      if (isLocalhost) {\r\n        // This is running on localhost. Let's check if a service worker still exists or not.\r\n        checkValidServiceWorker(swUrl, config);\r\n\r\n        // Add some additional logging to localhost, pointing developers to the\r\n        // service worker/PWA documentation.\r\n        navigator.serviceWorker.ready.then(() => {\r\n          console.log(\r\n            'This web app is being served cache-first by a service ' +\r\n              'worker. To learn more, visit http://bit.ly/CRA-PWA'\r\n          );\r\n        });\r\n      } else {\r\n        // Is not localhost. Just register service worker\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction registerValidSW(swUrl, config) {\r\n  navigator.serviceWorker\r\n    .register(swUrl)\r\n    .then(registration => {\r\n      registration.onupdatefound = () => {\r\n        const installingWorker = registration.installing;\r\n        installingWorker.onstatechange = () => {\r\n          if (installingWorker.state === 'installed') {\r\n            if (navigator.serviceWorker.controller) {\r\n              // At this point, the updated precached content has been fetched,\r\n              // but the previous service worker will still serve the older\r\n              // content until all client tabs are closed.\r\n              console.log(\r\n                'New content is available and will be used when all ' +\r\n                  'tabs for this page are closed. See http://bit.ly/CRA-PWA.'\r\n              );\r\n\r\n              // Execute callback\r\n              if (config && config.onUpdate) {\r\n                config.onUpdate(registration);\r\n              }\r\n            } else {\r\n              // At this point, everything has been precached.\r\n              // It's the perfect time to display a\r\n              // \"Content is cached for offline use.\" message.\r\n              console.log('Content is cached for offline use.');\r\n\r\n              // Execute callback\r\n              if (config && config.onSuccess) {\r\n                config.onSuccess(registration);\r\n              }\r\n            }\r\n          }\r\n        };\r\n      };\r\n    })\r\n    .catch(error => {\r\n      console.error('Error during service worker registration:', error);\r\n    });\r\n}\r\n\r\nfunction checkValidServiceWorker(swUrl, config) {\r\n  // Check if the service worker can be found. If it can't reload the page.\r\n  fetch(swUrl)\r\n    .then(response => {\r\n      // Ensure service worker exists, and that we really are getting a JS file.\r\n      if (\r\n        response.status === 404 ||\r\n        response.headers.get('content-type').indexOf('javascript') === -1\r\n      ) {\r\n        // No service worker found. Probably a different app. Reload the page.\r\n        navigator.serviceWorker.ready.then(registration => {\r\n          registration.unregister().then(() => {\r\n            window.location.reload();\r\n          });\r\n        });\r\n      } else {\r\n        // Service worker found. Proceed as normal.\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    })\r\n    .catch(() => {\r\n      console.log(\r\n        'No internet connection found. App is running in offline mode.'\r\n      );\r\n    });\r\n}\r\n\r\nexport function unregister() {\r\n  if ('serviceWorker' in navigator) {\r\n    navigator.serviceWorker.ready.then(registration => {\r\n      registration.unregister();\r\n    });\r\n  }\r\n}\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport { MuiThemeProvider} from '@material-ui/core/styles';\r\nimport * as Sentry from '@sentry/browser';\r\nimport * as SentryIntegrations from '@sentry/integrations';\r\n\r\nimport './index.css';\r\nimport App from './App';\r\nimport * as serviceWorker from './serviceWorker';\r\nimport { version } from '../package.json';\r\nimport theme from '@iobroker/adapter-react/Theme';\r\nimport Utils from '@iobroker/adapter-react/Components/Utils';\r\n\r\nwindow.adapterName = 'echarts-show';\r\nlet themeName = Utils.getThemeName();\r\n\r\nconsole.log('iobroker.' + window.adapterName + '@' + version + ' using theme \"' + themeName + '\"');\r\n\r\nfunction build() {\r\n    return ReactDOM.render(\r\n        <MuiThemeProvider theme={theme(themeName)}>\r\n            <App\r\n                onThemeChange={_theme => {\r\n                    themeName = _theme;\r\n                    build();\r\n                }}\r\n            />\r\n        </MuiThemeProvider>,\r\n        document.getElementById('root')\r\n    );\r\n}\r\n\r\n// if not local development\r\nif (window.location.host !== 'localhost:3000') {\r\n    Sentry.init({\r\n        dsn: 'https://cf39325071144219aa91bb3510addcdf@sentry.iobroker.net/95',\r\n        release: 'iobroker.' + window.adapterName + '@' + version,\r\n        integrations: [new SentryIntegrations.Dedupe()],\r\n    });\r\n}\r\n\r\nbuild();\r\n\r\n// If you want your app to work offline and load faster, you can change\r\n// unregister() to register() below. Note this comes with some pitfalls.\r\n// Learn more about service workers: http://bit.ly/CRA-PWA\r\nserviceWorker.unregister();\r\n"],"sourceRoot":""}